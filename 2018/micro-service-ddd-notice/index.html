<!doctype html><html class="theme-next muse use-motion" lang=en><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta http-equiv=content-language content=zh-cn><script src=//cdn.bootcss.com/pace/1.0.2/pace.min.js></script><link href=//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css rel=stylesheet><style>.pace .pace-progress{background:#ff009e;height:2px}.pace .pace-progress-inner{box-shadow:0 0 10px #e6006b,0 0 5px #ff009e}.pace .pace-activity{border-top-color:#ff009e;border-left-color:#ff009e}</style><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel=stylesheet><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel=stylesheet><link href="/css/main.css?v=5.1.0" rel=stylesheet><meta name=keywords content=Java,><link rel=alternate href=/atom.xml title="ookamiAntD's Blog" type=application/atom+xml><link rel="shortcut icon" type=image/x-icon href="/favicon.png?v=5.1.0"><meta name=description content="Preface 微服务架构:微服务 (Microservices) 是一种软件架构风格 (Software Architecture Style), 它是以专注于单一责任与功能的小型功能区块 (Small Building Blocks) 为基础, 利用模组化的方式组合出复杂的大型应用程序, 各功能区块使用与语言无关 (Language-Independent/Language agnostic"><meta name=keywords content=Java><meta property=og:type content=article><meta property=og:title content=关于微服务的一些调研零散笔记><meta property=og:url content=http://yangbingdong.com/2018/micro-service-ddd-notice/index.html><meta property=og:site_name content="ookamiAntD's Blog"><meta property=og:description content="Preface 微服务架构:微服务 (Microservices) 是一种软件架构风格 (Software Architecture Style), 它是以专注于单一责任与功能的小型功能区块 (Small Building Blocks) 为基础, 利用模组化的方式组合出复杂的大型应用程序, 各功能区块使用与语言无关 (Language-Independent/Language agnostic"><meta property=og:locale content=en><meta property=og:image content=https://cdn.yangbingdong.com/img/micro-service/microservice.png><meta property=og:image content=https://cdn.yangbingdong.com/img/micro-service/register-sync.jpg><meta property=og:image content=https://cdn.yangbingdong.com/img/micro-service/register-async.jpg><meta property=og:updated_time content=2020-04-07T10:15:47.010Z><meta name=twitter:card content=summary><meta name=twitter:title content=关于微服务的一些调研零散笔记><meta name=twitter:description content="Preface 微服务架构:微服务 (Microservices) 是一种软件架构风格 (Software Architecture Style), 它是以专注于单一责任与功能的小型功能区块 (Small Building Blocks) 为基础, 利用模组化的方式组合出复杂的大型应用程序, 各功能区块使用与语言无关 (Language-Independent/Language agnostic"><meta name=twitter:image content=https://cdn.yangbingdong.com/img/micro-service/microservice.png><script id=hexo.configurations>var NexT=window.NexT||{};var CONFIG={root:'/',scheme:'Muse',sidebar:{"position":"right","display":"always"},fancybox:true,motion:true,duoshuo:{userId:'undefined',author:'Author'},algolia:{applicationID:'RI3NF6GUI0',apiKey:'3d33fa60ba30d3b17f37220bb1a36749',indexName:'blogIndex',hits:{"per_page":10},labels:{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}};</script><link rel=canonical href=http://yangbingdong.com/2018/micro-service-ddd-notice/><script>(function(){if(''){if(prompt('请输入文章密码')!==''){alert('密码错误！');history.back();}}})();</script><title>关于微服务的一些调研零散笔记 | ookamiAntD's Blog</title><body itemscope itemtype=http://schema.org/WebPage lang=en><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?e9505ac4e11d464329d615553a72b526";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><div class="container one-collumn sidebar-position-right page-post-detail"><div class=headband></div><a href=https://github.com/masteranthoneyd/blog rel="external nofollow noopener noreferrer" target=_blank><img style=position:absolute;top:0;left:0;border:0 src=https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67 alt="Fork me on GitHub" data-canonical-src=https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png></a><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-meta><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title>ookamiAntD's Blog</span>
<span class=logo-line-after><i></i></span></a></div><h1 class=site-subtitle itemprop=description>Easy coding,easy life.</h1></div><div class=site-nav-toggle><button>
<span class=btn-bar></span><span class=btn-bar></span><span class=btn-bar></span></button></div><nav class=site-nav><ul id=menu class=menu><li class="menu-item menu-item-home"><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a><li class="menu-item menu-item-archives"><a href=/archives rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a><li class="menu-item menu-item-categories"><a href=/categories rel=section><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a><li class="menu-item menu-item-tags"><a href=/tags rel=section><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a><li class="menu-item menu-item-about"><a href=/about rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a><li class="menu-item menu-item-guestbook"><a href=/guestbook rel=section><i class="menu-item-icon fa fa-fw fa-commenting"></i><br>Message</a><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></ul><div class=site-search><div class=popup><span class="search-icon fa fa-search"></span><input id=local-search-input><div id=local-search-result></div><span class=popup-btn-close>close</span></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><div id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><link itemprop=mainEntityOfPage href=http://yangbingdong.com/2018/micro-service-ddd-notice/><span style=display:none itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=name content=ookamiAntD><meta itemprop=description content><meta itemprop=image content=/images/avatar/avatar-admin.jpg></span><span style=display:none itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="ookamiAntD's Blog"><span style=display:none itemprop=logo itemscope itemtype=http://schema.org/ImageObject><img style=display:none itemprop="url image" alt="ookamiAntD's Blog" src></span></span><header class=post-header><h2 class=post-title itemprop="name headline">关于微服务的一些调研零散笔记</h2><div class=post-meta><span class=post-time><span class=post-meta-item-icon><i class="fa fa-calendar-o"></i></span><span class=post-meta-item-text>Posted on</span>
<time title="Post created" itemprop="dateCreated datePublished" datetime=2018-01-02T16:59:14+08:00>2018-01-02</time></span>
<span class=post-category><span class=post-meta-divider>|</span>
<span class=post-meta-item-icon><i class="fa fa-folder-o"></i></span><span class=post-meta-item-text>In</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/Programming/ itemprop=url rel=index><span itemprop=name>Programming</span></a></span>
,
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/Programming/Java/ itemprop=url rel=index><span itemprop=name>Java</span></a></span></span>
<span id=/2018/micro-service-ddd-notice/ class=leancloud_visitors data-flag-title=关于微服务的一些调研零散笔记><span class=post-meta-divider>|</span>
<span class=post-meta-item-icon><i class="fa fa-eye"></i></span><span class=post-meta-item-text>Visitors</span>
<span class=leancloud-visitors-count></span></span><br><span class=post-time><span class=post-meta-item-icon><i class="fa fa-edit"></i></span><span class=post-meta-item-text>WordCount:</span>
<span class=post-count>3,635字</span>
<span class=post-meta-divider>|</span>
<span class=post-meta-item-text>min2read:</span>
<span class=post-count>13分钟</span></span></div></header><div class=post-body itemprop=articleBody><link rel=stylesheet href=https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css><p><img src=https://cdn.yangbingdong.com/img/micro-service/microservice.png alt><h1 id=Preface><a href=#Preface class=headerlink title=Preface></a>Preface</h1><blockquote><p><em><a href=https://zh.wikipedia.org/zh-cn/%E5%BE%AE%E6%9C%8D%E5%8B%99 rel="external nofollow noopener noreferrer" target=_blank>微服务架构</a></em>:<br><strong>微服务</strong> (Microservices) 是一种软件架构风格 (Software Architecture Style), 它是以专注于单一责任与功能的小型功能区块 (Small Building Blocks) 为基础, 利用模组化的方式组合出复杂的大型应用程序, 各功能区块使用与<strong>语言无关</strong> (Language-Independent/Language agnostic) 的 <strong>API 集相互通讯</strong>.</blockquote><blockquote><p><strong>不拆分存储的微服务是伪服务</strong>: 在实践中, 我们常常见到一种架构, 后端存储是全部和在一个数据库中, 仅仅把前端的业务逻辑拆分到不同的服务进程中, 本质上和一个Monolithic一样, 只是把模块之间的进程内调用改为进程间调用, 这种切分不可取, 违反了分布式第一原则, <strong>模块耦合没有解决</strong>, <strong>性能却受到了影响</strong>.</blockquote><a id=more></a><h1 id=Concept><a href=#Concept class=headerlink title=Concept></a>Concept</h1><p><strong>DDD</strong>: Domain-Driver Design 领域驱动设计<p><strong>CQRS</strong>: Command Query Responsibility Segregation 命令查询职责分离<p><strong><a href=http://microservices.io/patterns/data/event-sourcing.html rel="external nofollow noopener noreferrer" target=_blank>Event Sourcing</a></strong>: 事件溯源<p><strong>Event-driven Architecture</strong>: 事件驱动架构, 使用事件来实现跨多个服务的业务逻辑<p><strong>Saga</strong>: 长时间活动的事务(Long Lived Transaction, 简称为LLT)<br>SEC(Saga Execution Coordinator): 一个基于事件驱动的状态机的协调器<br><em><a href=http://newtech.club/2017/07/16/Design%20for%20Failure-Saga%E6%A8%A1%E5%BC%8F%E5%92%8C%E6%B6%88%E6%81%AF%E9%A9%B1%E5%8A%A8/ rel="external nofollow noopener noreferrer" target=_blank>Saga模式和事件驱动</a></em><p><strong>贫血模型</strong>: 对象只用于在各层之间传输数据用, <strong>只有数据字段和Get/Set方法</strong>, 没有逻辑在对象中<br><strong>充血模型</strong>: <strong>将数据和行为封装在一起</strong>, 并与现实世界的业务对象相映射. 各类具备明确的职责划分, 使得逻辑分散到合适对象中. (领域模型)<h1 id=Problem><a href=#Problem class=headerlink title=Problem></a>Problem</h1><p><strong>微服务架构必须解决这三个问题</strong><br><strong>拆分领域模型</strong>、<strong>事务</strong>、<strong>查询</strong><h2 id=拆分领域模型><a href=#拆分领域模型 class=headerlink title=拆分领域模型></a>拆分领域模型</h2><p>遵循Single Responsibility(单一职责)<br><strong>Aggregate</strong>(聚合):<ul><li>聚合通过id（例如主键）来引用而不是通过对象引用<li>聚合必须遵循一个事务只能对一个聚合进行创建或更新<li>聚合应该尽量细</ul><h2 id=事务><a href=#事务 class=headerlink title=事务></a>事务</h2><p>由于采用了微服务拥有各自的私人数据库, 只能通过API访问, 不可避免出现了分布式跨数据库事务问题.<h3 id=ACID-vs-BASE><a href=#ACID-vs-BASE class=headerlink title="ACID vs BASE"></a>ACID vs BASE</h3><p>传统事务 <strong>ACID</strong>:<ul><li>Atomicity（原子性）: 一个事务中的操作是原子的, 其中任何一步失败, 系统都能够完全回到事务前的状态<li>Consistency（一致性）: 数据库的状态始终保持一致<li>Isolation（隔离性）: 多个并发执行的事务不会互相影响<li>Durability（持久性）: 事务处理结束后, 对数据的修改是永久的</ul><p>微服务下依靠分布式事务（如2PC）保证实时一致性（强一致性）, 性能底下, 牺牲了可用性, 已不适用于现代的微服务架构.<p><strong>BASE</strong>模型:<ul><li>Basically Available（基本可用）: 系统在出现不可预知的故障的时候, 允许损失部分可用性, 但不等于系统不可用<li>Soft State（软状态）: 允许系统中的数据存在中间状态, 并认为该中间状态的存在不会影响系统的整体可用性<li>Eventually Consistent（最终一致性）: 系统保证最终数据能够达到一致</ul><p>微服务倡导每个微服务拥有私有的数据库, 且其他服务不能直接与访问该数据库, 只能通过该服务暴露的API进行交互.<h3 id=TCC><a href=#TCC class=headerlink title=TCC></a>TCC</h3><p>业务层面的2PC, 需要实现<code>Try</code>、<code>Comfirm</code>、<code>Cancel</code><br><em><a href="https://github.com/search?l=Java&amp;o=desc&amp;q=tcc&amp;s=stars&amp;type=Repositories&amp;utf8=%E2%9C%93" rel="external nofollow noopener noreferrer" target=_blank>GitHub中TCC实现框架</a></em><h3 id=基于可靠消息达到最终一致性><a href=#基于可靠消息达到最终一致性 class=headerlink title=基于可靠消息达到最终一致性></a>基于可靠消息达到最终一致性</h3><p>缺点是应用程序不能够立即读取到自己刚刚的写入（滞后性）.<h4 id=使用本地事务><a href=#使用本地事务 class=headerlink title=使用本地事务></a>使用本地事务</h4><p>对资源的操作与发布时间捆绑在同一事务中.<br>优点: 使用了本地数据库的事务, 如果Event没有插入或发布成功, 那么订单也不会被创建.<br>缺点: 需要单独处理Event发布在业务逻辑中, 繁琐容易忘记；Event发送有些滞后.<h4 id=使用数据库特有的MySQL-Binlog跟踪><a href=#使用数据库特有的MySQL-Binlog跟踪 class=headerlink title="使用数据库特有的MySQL Binlog跟踪"></a>使用数据库特有的MySQL Binlog跟踪</h4><p>订阅binlog发送event<br>优点: 提高了性能<br>缺点: 不同的数据库, 日志格式不一样, 而且同一数据库, 不同版本格式也可能不一样, 决策的时候请慎重.<h3 id=Event-Sourcing><a href=#Event-Sourcing class=headerlink title="Event Sourcing"></a>Event Sourcing</h3><p>颠覆传统存储概念, 不持久化对象数据, 而是持久化对象变更的Event, 通过溯源, 遍历事件拿到对象的最新状态. 在我看来, 类似文件系统的概念, 一个操作是一层, 删除并不是减掉一层, 而是添加一层删除操作（类似Git中的版本, 可回滚, 有记录追踪）.<h3 id=阿里云GTS全局事务><a href=#阿里云GTS全局事务 class=headerlink title=阿里云GTS全局事务></a>阿里云GTS全局事务</h3><p><strong><em><a href=https://help.aliyun.com/document_detail/48726.html rel="external nofollow noopener noreferrer" target=_blank>GTS（Global Transaction Service）官方文档</a></em></strong>（需要捆绑Ali全家桶. . . ）<h2 id=查询><a href=#查询 class=headerlink title=查询></a>查询</h2><p>实践微服务之后, 除了事务之外, 查询是又是另外一个挑战. 在传统架构中, 我们可以JOIN多个表进行查询, 但在微服务当中, 数据库已经分开, 如果是通过Event Sourcing实现的架构就更加困难了（因为存储的是事件）.<p>解决之道: <strong>CQRS</strong><h1 id=Extend><a href=#Extend class=headerlink title=Extend></a>Extend</h1><h2 id=Event-driven><a href=#Event-driven class=headerlink title=Event-driven></a>Event-driven</h2><p><code>Sync</code>（请求/响应）: 串行架构<p><img src=https://cdn.yangbingdong.com/img/micro-service/register-sync.jpg alt><br>优点: 个人认为, 只有一个优点, 可以偷懒<br>缺点: 中心控制点承担了太多的职责, 入侵式强耦合代码, 如果此时多加一个业务例如创建用户团队, 那就必须在原来代码基础上继续入侵代码, 而且修改一行代码有可能影响到下文.<p><code>Async</code>（基于事件）: 并行/异步架构<p><img src=https://cdn.yangbingdong.com/img/micro-service/register-async.jpg alt><br>优点: 客户端发起的不是一个请求, 而是<strong>发布一个事件</strong>, 然后其他协作者接收到该事件, 并知道该怎么做. 我们从来不会告知任何人去做任何事, 基于事件的系统天生就是<strong>异步</strong>的. 整个系统都很聪明, 业务逻辑并非存在某个核心大脑, 而是分布在不同的协作者中. 基于事件的协作方式耦合性很低, 这意味着你可以在<strong>不改变客户端代码</strong>的情况下, 对该事件<strong>添加新的订阅者来完成新增的功能需求</strong>.<h2 id=Spring-Cloud-Framework><a href=#Spring-Cloud-Framework class=headerlink title="Spring Cloud Framework"></a>Spring Cloud Framework</h2><h3 id=Spring-Cloud-Netflix><a href=#Spring-Cloud-Netflix class=headerlink title="Spring Cloud Netflix"></a>Spring Cloud Netflix</h3><p>这可是个大boss, 地位仅次于老大, 老大各项服务依赖与它, 与各种Netflix OSS组件集成, 组成微服务的核心, 它的小弟主要有Eureka, Hystrix, Zuul, Archaius… 太多了<p><strong>Netflix Eureka</strong><p>服务中心, 云端服务发现, 一个基于 REST 的服务, 用于定位服务, 以实现云端中间层服务发现和故障转移. 这个可是springcloud最牛鼻的小弟, 服务中心, 任何小弟需要其它小弟支持什么都需要从这里来拿, 同样的你有什么独门武功的都赶紧过报道, 方便以后其它小弟来调用；它的好处是你不需要直接找各种什么小弟支持, 只需要到服务中心来领取, 也不需要知道提供支持的其它小弟在哪里, 还是几个小弟来支持的, 反正拿来用就行, 服务中心来保证稳定性和质量.<p><strong>Netflix Hystrix</strong><p>熔断器, 容错管理工具, 旨在通过熔断机制控制服务和第三方库的节点,从而对延迟和故障提供更强大的容错能力. 比如突然某个小弟生病了, 但是你还需要它的支持, 然后调用之后它半天没有响应, 你却不知道, 一直在等等这个响应；有可能别的小弟也正在调用你的武功绝技, 那么当请求多之后, 就会发生严重的阻塞影响老大的整体计划. 这个时候Hystrix就派上用场了, 当Hystrix发现某个小弟不在状态不稳定立马马上让它下线, 让其它小弟来顶上来, 或者给你说不用等了这个小弟今天肯定不行, 该干嘛赶紧干嘛去别在这排队了.<p><strong>Netflix Zuul</strong><p>Zuul 是在云平台上提供动态路由,监控,弹性,安全等边缘服务的框架. Zuul 相当于是设备和 Netflix 流应用的 Web 网站后端所有请求的前门. 当其它门派来找大哥办事的时候一定要先经过zuul,看下有没有带刀子什么的给拦截回去, 或者是需要找那个小弟的直接给带过去.<p><strong>Netflix Archaius</strong><p>配置管理API, 包含一系列配置管理API, 提供动态类型化属性、线程安全配置操作、轮询框架、回调机制等功能. 可以实现动态获取配置, 原理是每隔60s（默认, 可配置）从配置源读取一次内容, 这样修改了配置文件后不需要重启服务就可以使修改后的内容生效, 前提使用archaius的API来读取.<h3 id=Spring-Cloud-Config><a href=#Spring-Cloud-Config class=headerlink title="Spring Cloud Config"></a>Spring Cloud Config</h3><p>俗称的配置中心, 配置管理工具包, 让你可以把配置放到远程服务器, 集中化管理集群配置, 目前支持本地存储、Git以及Subversion. 就是以后大家武器、枪火什么的东西都集中放到一起, 别随便自己带, 方便以后统一管理、升级装备.<h3 id=Spring-Cloud-Bus><a href=#Spring-Cloud-Bus class=headerlink title="Spring Cloud Bus"></a>Spring Cloud Bus</h3><p>事件、消息总线, 用于在集群（例如, 配置变化事件）中传播状态变化, 可与Spring Cloud Config联合实现热部署. 相当于水浒传中日行八百里的神行太保戴宗, 确保各个小弟之间消息保持畅通.<h3 id=Spring-Cloud-for-Cloud-Foundry><a href=#Spring-Cloud-for-Cloud-Foundry class=headerlink title="Spring Cloud for Cloud Foundry"></a>Spring Cloud for Cloud Foundry</h3><p>Cloud Foundry是VMware推出的业界第一个开源PaaS云平台, 它支持多种框架、语言、运行时环境、云平台及应用服务, 使开发人员能够在几秒钟内进行应用程序的部署和扩展, 无需担心任何基础架构的问题<p>其实就是与CloudFoundry进行集成的一套解决方案, 抱了Cloud Foundry的大腿.<h3 id=Spring-Cloud-Cluster><a href=#Spring-Cloud-Cluster class=headerlink title="Spring Cloud Cluster"></a>Spring Cloud Cluster</h3><p>Spring Cloud Cluster将取代Spring Integration. 提供在分布式系统中的集群所需要的基础功能支持, 如: 选举、集群的状态一致性、全局锁、tokens等常见状态模式的抽象和实现.<p>如果把不同的帮派组织成统一的整体, Spring Cloud Cluster已经帮你提供了很多方便组织成统一的工具.<h3 id=Spring-Cloud-Consul><a href=#Spring-Cloud-Consul class=headerlink title="Spring Cloud Consul"></a>Spring Cloud Consul</h3><p>Consul 是一个支持多数据中心分布式高可用的服务发现和配置共享的服务软件,由 HashiCorp 公司用 Go 语言开发, 基于 Mozilla Public License 2.0 的协议进行开源. Consul 支持健康检查,并允许 HTTP 和 DNS 协议调用 API 存储键值对.<p>Spring Cloud Consul 封装了Consul操作, consul是一个服务发现与配置工具, 与Docker容器可以无缝集成.<h3 id=其它小弟><a href=#其它小弟 class=headerlink title=其它小弟></a>其它小弟</h3><p><strong>Spring Cloud Security</strong><p>基于spring security的安全工具包, 为你的应用程序添加安全控制. 这个小弟很牛鼻专门负责整个帮派的安全问题, 设置不同的门派访问特定的资源, 不能把秘籍葵花宝典泄漏了.<p><strong>Spring Cloud Sleuth</strong><p>日志收集工具包, 封装了Dapper和log-based追踪以及Zipkin和HTrace操作, 为SpringCloud应用实现了一种分布式追踪解决方案.<p><strong>Spring Cloud Data Flow</strong><ul><li>Data flow 是一个用于开发和执行大范围数据处理其模式包括ETL, 批量运算和持续运算的统一编程模型和托管服务.<li>对于在现代运行环境中可组合的微服务程序来说, Spring Cloud data flow是一个原生云可编配的服务. 使用Spring Cloud data flow, 开发者可以为像数据抽取, 实时分析, 和数据导入/导出这种常见用例创建和编配数据通道 （data pipelines）.<li>Spring Cloud data flow 是基于原生云对 spring XD的重新设计, 该项目目标是简化大数据应用的开发. Spring XD 的流处理和批处理模块的重构分别是基于 Spring Boot的stream 和 task/batch 的微服务程序. 这些程序现在都是自动部署单元而且他们原生的支持像 Cloud Foundry、Apache YARN、Apache Mesos和Kubernetes 等现代运行环境.<li>Spring Cloud data flow 为基于微服务的分布式流处理和批处理数据通道提供了一系列模型和最佳实践.</ul><p><strong>Spring Cloud Stream</strong><p>Spring Cloud Stream是创建消息驱动微服务应用的框架. Spring Cloud Stream是基于Spring Boot创建, 用来建立单独的／工业级spring应用, 使用spring integration提供与消息代理之间的连接. 数据流操作开发包, 封装了与Redis,Rabbit、Kafka等发送接收消息.<p>一个业务会牵扯到多个任务, 任务之间是通过事件触发的, 这就是Spring Cloud stream要干的事了<p><strong>Spring Cloud Task</strong><p>Spring Cloud Task 主要解决短命微服务的任务管理, 任务调度的工作, 比如说某些定时任务晚上就跑一次, 或者某项数据分析临时就跑几次.<p><strong>Spring Cloud Zookeeper</strong><p>ZooKeeper是一个分布式的, 开放源码的分布式应用程序协调服务, 是Google的Chubby一个开源的实现, 是Hadoop和Hbase的重要组件. 它是一个为分布式应用提供一致性服务的软件, 提供的功能包括: 配置维护、域名服务、分布式同步、组服务等. ZooKeeper的目标就是封装好复杂易出错的关键服务, 将简单易用的接口和性能高效、功能稳定的系统提供给用户.<p>操作Zookeeper的工具包, 用于使用zookeeper方式的服务发现和配置管理, 抱了Zookeeper的大腿.<p><strong>Spring Cloud Connectors</strong><p>Spring Cloud Connectors 简化了连接到服务的过程和从云平台获取操作的过程, 有很强的扩展性, 可以利用Spring Cloud Connectors来构建你自己的云平台.<p>便于云端应用程序在各种PaaS平台连接到后端, 如: 数据库和消息代理服务.<p><strong>Spring Cloud Starters</strong><p>Spring Boot式的启动项目, 为Spring Cloud提供开箱即用的依赖管理.<p><strong>Spring Cloud CLI</strong><p>基于 Spring Boot CLI, 可以让你以命令行方式快速建立云组件.<h2 id=Demo><a href=#Demo class=headerlink title=Demo></a>Demo</h2><p><em><a href=https://github.com/JoeCao/OrderEventDrivenDemo rel="external nofollow noopener noreferrer" target=_blank>基于事件驱动+事件溯源+Saga的微服务示例</a></em><p><em><a href=https://github.com/chaokunyang/microservices-event-sourcing rel="external nofollow noopener noreferrer" target=_blank>一个微服务架构的在线购物网站（CQRS+Event Sourcing）</a></em><p><em><a href=https://github.com/kbastani/spring-cloud-event-sourcing-example rel="external nofollow noopener noreferrer" target=_blank>spring-cloud-event-sourcing-example</a></em><p><em><a href=https://github.com/AxonFramework/AxonFramework rel="external nofollow noopener noreferrer" target=_blank>CQRS实现框架AxonFramework</a></em><p><em><a href=https://github.com/eventuate-local/eventuate-local rel="external nofollow noopener noreferrer" target=_blank>溯源实现框架Eventuate Local</a></em></div><div style=text-align:center;color:#ccc;font-size:14px>---------------- The End ----------------</div><div><div id=wechat_subscriber style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id=wechat_subscriber_qcode src=/images/wechat/gongzhonghao.jpg alt="ookamiAntD wechat" style=width:200px;max-width:100%><div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>谢谢大爷～</div><button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');if(qr.style.display==='none'){qr.style.display='block';}else{qr.style.display='none'}">
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/images/donate/wechat.png alt="ookamiAntD WeChat Pay"><p>微信打赏</div><div id=alipay style=display:inline-block><img id=alipay_qr src=/images/donate/alipay.jpg alt="ookamiAntD Alipay"><p>支付宝打赏</div></div></div></div><div><p id=div-border-left-red>Author：<b>ookamiAntD Yang</b><br>Link：<a href=/2018/micro-service-ddd-notice/ title=关于微服务的一些调研零散笔记>http://yangbingdong.com/2018/micro-service-ddd-notice/</a><br>Contact：<a>yangbingdong1994@gmail.com</a><br><b>本文基于<a target=_blank title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href=http://creativecommons.org/licenses/by-sa/4.0/ rel="external nofollow noopener noreferrer"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br><b>转载请注明出处，谢谢！</b></div><footer class=post-footer><div class=post-tags><a href=/tags/Java/ rel=tag><i class="fa fa-tag"></i>Java</a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/2018/docker-visual-management-and-orchestrate-tools/ rel=next title=Docker可视化与管理工具><i class="fa fa-chevron-left"></i>Docker可视化与管理工具</a></div><span class=post-nav-divider></span><div class="post-nav-prev post-nav-item"><a href=/2018/disruptor-learning/ rel=prev title="极致的追求, 高性能并发框架 Disruptor">极致的追求, 高性能并发框架 Disruptor <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class=post-spread><div class=-hoofoo-share-title>分享到：</div><div class=-hoofoo-share-buttons><div class="-mob-share-weibo -hoofoo-share-weibo -hoofoo-share-ui-button"><i class="fa fa-weibo" aria-hidden=true></i></div><div class="-mob-share-weixin -hoofoo-share-weixin -hoofoo-share-ui-button"><i class="fa fa-weixin" aria-hidden=true></i></div><div class="-mob-share-qq -hoofoo-share-qq -hoofoo-share-ui-button"><i class="fa fa-qq" aria-hidden=true></i></div><div class="-mob-share-twitter -hoofoo-share-twitter -hoofoo-share-ui-button"><i class="fa fa-twitter" aria-hidden=true></i></div><div class="-hoofoo-share-more -hoofoo-share-ui-button -mob-share-open"><i class="fa fa-ellipsis-h" aria-hidden=true></i></div></div><div class=-mob-share-ui style=display:none><ul class=-mob-share-list><li class=-mob-share-weibo><p>新浪微博<li class=-mob-share-weixin><p>微信<li class=-mob-share-qzone><p>QQ空间<li class=-mob-share-qq><p>QQ好友<li class=-mob-share-tencentweibo><p>腾讯微博<li class=-mob-share-renren><p>人人网<li class=-mob-share-kaixin><p>开心网<li class=-mob-share-douban><p>豆瓣<li class=-mob-share-youdao><p>有道云笔记<li class=-mob-share-mingdao><p>明道<li class=-mob-share-pengyou><p>朋友网<li class=-mob-share-facebook><p>Facebook<li class=-mob-share-twitter><p>Twitter<li class=-mob-share-pocket><p>Pocket<li class=-mob-share-google><p>Google+<li class=-mob-share-tumblr><p>Tumblr<li class=-mob-share-instapaper><p>Instapaper<li class=-mob-share-linkedin><p>Linkedin</ul><div class=-mob-share-close>取消</div></div><div class=-mob-share-ui-bg></div><script id=-mob-share src="https://f1.webshare.mob.com/code/mob-share.js?appkey=21aa3b13ad233"></script></div></div></div><div class=comments id=comments><div style=text-align:center></div><div id=disqus_proxy_thread></div><div id=disqus_thread></div><script>window.disqusProxy={username:'ookamiantd',server:'disqus-proxy.yangbingdong.com',port:'',defaultAvatar:'/images/avatar/avatar-default.jpg',adminAvatar:'/images/avatar/avatar-admin.jpg',identifier:'2018/micro-service-ddd-notice/'};window.disqus_config=function(){this.page.url='http://yangbingdong.com/2018/micro-service-ddd-notice/';this.page.identifier='2018/micro-service-ddd-notice/';};window.onload=function(){var s=document.createElement('script');s.src="/static/js/main.0d0338ae.js";s.async=true;document.body.appendChild(s);}</script><link rel=stylesheet href=/static/css/main.0603c539.css></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>Table of Contents<li class=sidebar-nav-overview data-target=site-overview>Overview</ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar/avatar-admin.jpg alt=ookamiAntD><p class=site-author-name itemprop=name>ookamiAntD<p class="site-description motion-element" itemprop=description>码渣 | rocker | 二次元 | 美剧 | 宅</div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/archives><span class=site-state-item-count>48</span>
<span class=site-state-item-name>posts</span></a></div><div class="site-state-item site-state-categories"><a href=/categories><span class=site-state-item-count>19</span>
<span class=site-state-item-name>categories</span></a></div><div class="site-state-item site-state-tags"><a href=/tags><span class=site-state-item-count>45</span>
<span class=site-state-item-name>tags</span></a></div></nav><div class="feed-link motion-element"><a href=/atom.xml rel=alternate><i class="fa fa-rss"></i>RSS</a></div><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/masteranthoneyd target=_blank rel="external nofollow noopener noreferrer" title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span>
<span class=links-of-author-item><a href="https://www.facebook.com/profile.php?id=100014869064462" target=_blank rel="external nofollow noopener noreferrer" title=Facebook><i class="fa fa-fw fa-facebook"></i>Facebook</a></span>
<span class=links-of-author-item><a href=https://twitter.com/ookamiAntD target=_blank rel="external nofollow noopener noreferrer" title=Twitter><i class="fa fa-fw fa-twitter"></i>Twitter</a></span></div><div class="cc-license motion-element" itemprop=license><a href=https://creativecommons.org/licenses/by-sa/4.0/ class=cc-opacity target=_blank rel="external nofollow noopener noreferrer"><img src=/images/cc-by-sa.svg alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class=links-of-blogroll-title><i class="fa  fa-fw fa-globe"></i>大神们的博客</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://mercyblitz.github.io/ title=mercyblitz(Java劝退师) target=_blank rel="external nofollow noopener noreferrer">mercyblitz(Java劝退师)</a><li class=links-of-blogroll-item><a href=https://muyinchen.github.io/ title=知秋大神(真·大神) target=_blank rel="external nofollow noopener noreferrer">知秋大神(真·大神)</a><li class=links-of-blogroll-item><a href=http://crossoverjie.top/ title="crossoverJie's Blog" target=_blank rel="external nofollow noopener noreferrer">crossoverJie's Blog</a><li class=links-of-blogroll-item><a href=http://yemengying.com/ title="Giraffe's Home" target=_blank rel="external nofollow noopener noreferrer">Giraffe's Home</a></ul></div><div id=days></div><script>function show_date_time(){window.setTimeout("show_date_time()",1000);BirthDay=new Date("01/10/2017 12:34:56");today=new Date();timeold=(today.getTime()-BirthDay.getTime());sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);e_hrsold=(e_daysold-daysold)*24;hrsold=setzero(Math.floor(e_hrsold));e_minsold=(e_hrsold-hrsold)*60;minsold=setzero(Math.floor((e_hrsold-hrsold)*60));seconds=setzero(Math.floor((e_minsold-minsold)*60));document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";}
function setzero(i){if(i<10)
{i="0"+i};return i;}
show_date_time();</script></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link href=#Preface><span class=nav-number>1.</span> <span class=nav-text>Preface</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#Concept><span class=nav-number>2.</span> <span class=nav-text>Concept</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#Problem><span class=nav-number>3.</span> <span class=nav-text>Problem</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#拆分领域模型><span class=nav-number>3.1.</span> <span class=nav-text>拆分领域模型</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#事务><span class=nav-number>3.2.</span> <span class=nav-text>事务</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#ACID-vs-BASE><span class=nav-number>3.2.1.</span> <span class=nav-text>ACID vs BASE</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#TCC><span class=nav-number>3.2.2.</span> <span class=nav-text>TCC</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#基于可靠消息达到最终一致性><span class=nav-number>3.2.3.</span> <span class=nav-text>基于可靠消息达到最终一致性</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#使用本地事务><span class=nav-number>3.2.3.1.</span> <span class=nav-text>使用本地事务</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#使用数据库特有的MySQL-Binlog跟踪><span class=nav-number>3.2.3.2.</span> <span class=nav-text>使用数据库特有的MySQL Binlog跟踪</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#Event-Sourcing><span class=nav-number>3.2.4.</span> <span class=nav-text>Event Sourcing</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#阿里云GTS全局事务><span class=nav-number>3.2.5.</span> <span class=nav-text>阿里云GTS全局事务</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#查询><span class=nav-number>3.3.</span> <span class=nav-text>查询</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#Extend><span class=nav-number>4.</span> <span class=nav-text>Extend</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Event-driven><span class=nav-number>4.1.</span> <span class=nav-text>Event-driven</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Spring-Cloud-Framework><span class=nav-number>4.2.</span> <span class=nav-text>Spring Cloud Framework</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Netflix><span class=nav-number>4.2.1.</span> <span class=nav-text>Spring Cloud Netflix</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Config><span class=nav-number>4.2.2.</span> <span class=nav-text>Spring Cloud Config</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Bus><span class=nav-number>4.2.3.</span> <span class=nav-text>Spring Cloud Bus</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-for-Cloud-Foundry><span class=nav-number>4.2.4.</span> <span class=nav-text>Spring Cloud for Cloud Foundry</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Cluster><span class=nav-number>4.2.5.</span> <span class=nav-text>Spring Cloud Cluster</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Spring-Cloud-Consul><span class=nav-number>4.2.6.</span> <span class=nav-text>Spring Cloud Consul</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#其它小弟><span class=nav-number>4.2.7.</span> <span class=nav-text>其它小弟</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Demo><span class=nav-number>4.3.</span> <span class=nav-text>Demo</span></a></ol></ol></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=busuanzi-count><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user">本站访客数</i><span class=busuanzi-value id=busuanzi_value_site_uv></span>人次</span>
<span class=site-pv><i class="fa fa-eye">本站总访问量</i><span class=busuanzi-value id=busuanzi_value_site_pv></span>次</span></div><div class=copyright>&copy; 2016 -
<span itemprop=copyrightYear>2020</span>
<span class=with-love><i class="fa fa-flash"></i></span><span class=author itemprop=copyrightHolder>Hosted by <a href=https://pages.coding.me style=font-weight:700 rel="external nofollow noopener noreferrer" target=_blank>Coding Pages</a></span> | <span class=post-count>共280.0k字</span></div><div class=theme-info><a target=_blank href=http://www.miibeian.gov.cn/ rel=nofollow style=color:#555>粤ICP备18135202号-1</a></div><div style="width:300px;margin:0 auto"><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44010602005896" style=display:inline-block;text-decoration:none;height:20px;line-height:20px><img src=https://cdn.yangbingdong.com/img/beian/beian.png style=float:left><p style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#555">粤公网安备 44010602005896号</p></a></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i></div></div><script>if(Object.prototype.toString.call(window.Promise)!=='[object Function]'){window.Promise=null;}</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script src="/js/src/utils.js?v=5.1.0"></script><script src="/js/src/motion.js?v=5.1.0"></script><script src="/js/src/scrollspy.js?v=5.1.0"></script><script src="/js/src/post-details.js?v=5.1.0"></script><script src="/js/src/bootstrap.js?v=5.1.0"></script><script>var disqus_shortname='ookamiantd';var disqus_identifier='2018/micro-service-ddd-notice/';var disqus_title="关于微服务的一些调研零散笔记";function run_disqus_script(disqus_script){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}
var disqus={load:function disqus(){if(typeof DISQUS!=='object'){(function(){var s=document.createElement('script');s.async=true;s.type='text/javascript';s.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('HEAD')[0]||document.getElementsByTagName('BODY')[0]).appendChild(s);}());$('#load-disqus').html("评论加载中，请确保你有梯子，若评论长时间未加载则你可能翻墙失败...").fadeOut(9000);}}}</script><script>var isfetched=false;var search_path="search.xml";if(search_path.length==0){search_path="search.xml";}
var path="/"+search_path;function proceedsearch(){$("body").append('<div class="popoverlay">').css('overflow','hidden');$('.popup').toggle();}
var searchFunc=function(path,search_id,content_id){'use strict';$.ajax({url:path,dataType:"xml",async:true,success:function(xmlResponse){isfetched=true;$('.popup').detach().appendTo('.header-inner');var datas=$("entry",xmlResponse).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()};}).get();var $input=document.getElementById(search_id);var $resultContent=document.getElementById(content_id);$input.addEventListener('input',function(){var matchcounts=0;var str='<ul class=\"search-result-list\">';var keywords=this.value.trim().toLowerCase().split(/[\s\-]+/);$resultContent.innerHTML="";if(this.value.trim().length>1){datas.forEach(function(data){var isMatch=false;var content_index=[];var data_title=data.title.trim().toLowerCase();var data_content=data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();var data_url=decodeURIComponent(data.url);var index_title=-1;var index_content=-1;var first_occur=-1;if(data_title!=''){keywords.forEach(function(keyword,i){index_title=data_title.indexOf(keyword);index_content=data_content.indexOf(keyword);if(index_title>=0||index_content>=0){isMatch=true;if(i==0){first_occur=index_content;}}});}
if(isMatch){matchcounts+=1;str+="<li><a href='"+data_url+"' class='search-result-title'>"+data_title+"</a>";var content=data.content.trim().replace(/<[^>]+>/g,"");if(first_occur>=0){var start=first_occur-20;var end=first_occur+80;if(start<0){start=0;}
if(start==0){end=50;}
if(end>content.length){end=content.length;}
var match_content=content.substring(start,end);keywords.forEach(function(keyword){var regS=new RegExp(keyword,"gi");match_content=match_content.replace(regS,"<b class=\"search-keyword\">"+keyword+"</b>");});str+="<p class=\"search-result\">"+match_content+"...</p>"}
str+="</li>";}})};str+="</ul>";if(matchcounts==0){str='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'}
if(keywords==""){str='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'}
$resultContent.innerHTML=str;});proceedsearch();}});}
$('.popup-trigger').click(function(e){e.stopPropagation();if(isfetched==false){searchFunc(path,'local-search-input','local-search-result');}else{proceedsearch();};});$('.popup-btn-close').click(function(e){$('.popup').hide();$(".popoverlay").remove();$('body').css('overflow','');});$('.popup').click(function(e){e.stopPropagation();});</script><script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js></script><script>AV.initialize("usE0s6JGUeOiMcsVoRuHuv2B-gzGzoHsz","ewm6NEF07r83HbnOr63ptuKH");</script><script>function showTime(Counter){var query=new AV.Query(Counter);var entries=[];var $visitors=$(".leancloud_visitors");$visitors.each(function(){entries.push($(this).attr("id").trim());});query.containedIn('url',entries);query.find().done(function(results){var COUNT_CONTAINER_REF='.leancloud-visitors-count';if(results.length===0){$visitors.find(COUNT_CONTAINER_REF).text(0);return;}
for(var i=0;i<results.length;i++){var item=results[i];var url=item.get('url');var time=item.get('time');var element=document.getElementById(url);$(element).find(COUNT_CONTAINER_REF).text(time);}
for(var i=0;i<entries.length;i++){var url=entries[i];var element=document.getElementById(url);var countSpan=$(element).find(COUNT_CONTAINER_REF);if(countSpan.text()==''){countSpan.text(0);}}}).fail(function(object,error){console.log("Error: "+error.code+" "+error.message);});}
function addCount(Counter){var $visitors=$(".leancloud_visitors");var url=$visitors.attr('id').trim();var title=$visitors.attr('data-flag-title').trim();var query=new AV.Query(Counter);query.equalTo("url",url);query.find({success:function(results){if(results.length>0){var counter=results[0];counter.fetchWhenSave(true);counter.increment("time");counter.save(null,{success:function(counter){var $element=$(document.getElementById(url));$element.find('.leancloud-visitors-count').text(counter.get('time'));},error:function(counter,error){console.log('Failed to save Visitor num, with error message: '+error.message);}});}else{var newcounter=new Counter();var acl=new AV.ACL();acl.setPublicReadAccess(true);acl.setPublicWriteAccess(true);newcounter.setACL(acl);newcounter.set("title",title);newcounter.set("url",url);newcounter.set("time",1);newcounter.save(null,{success:function(newcounter){var $element=$(document.getElementById(url));$element.find('.leancloud-visitors-count').text(newcounter.get('time'));},error:function(newcounter,error){console.log('Failed to create');}});}},error:function(error){console.log('Error:'+error.code+" "+error.message);}});}
$(function(){var Counter=AV.Object.extend("Counter");if($('.leancloud_visitors').length==1){addCount(Counter);}else if($('.post-title-link').length>1){showTime(Counter);}});</script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script color=255,0,204 opacity=0.5 zindex=-2 count=40 src=//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js></script><script>$('body').delegate('.-mob-share-weixin-qrcode-bg','click',function(){$(".-mob-share-weixin-qrcode-close").trigger("click");});</script><canvas class=fireworks style=position:fixed;left:0;top:0;z-index:1;pointer-events:none></canvas>
<script src=//cdn.bootcss.com/animejs/2.2.0/anime.min.js></script><script src=/js/src/fireworks.js></script><script src=/js/src/dytitle.js></script></div></footer></div><script src=/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"superSample":2,"width":88,"height":88,"position":"left"},"mobile":{"show":false},"react":{"opacityDefault":0.9,"opacityOnHover":0.5},"log":false});</script>