<!doctype html><html class="theme-next muse use-motion" lang=en><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta http-equiv=content-language content=zh-cn><script src=//cdn.bootcss.com/pace/1.0.2/pace.min.js></script><link href=//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css rel=stylesheet><style>.pace .pace-progress{background:#ff009e;height:2px}.pace .pace-progress-inner{box-shadow:0 0 10px #e6006b,0 0 5px #ff009e}.pace .pace-activity{border-top-color:#ff009e;border-left-color:#ff009e}</style><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel=stylesheet><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel=stylesheet><link href="/css/main.css?v=5.1.0" rel=stylesheet><meta name=keywords content=VPS,ShadowSocks,V2Ray,Trojan,><link rel=alternate href=/atom.xml title="ookamiAntD's Blog" type=application/atom+xml><link rel="shortcut icon" type=image/x-icon href="/favicon.png?v=5.1.0"><meta name=description content="Preface 作为一名开发人员, 日常离不开 Google, 那么在这之前, 必须要先学会如何代理. 本人 Linode 邀请码: 79e24952d46644605b071a55c4fda3b23e1d1a5a"><meta name=keywords content=VPS,ShadowSocks,V2Ray,Trojan><meta property=og:type content=article><meta property=og:title content="V2Proxy 正确的代理模式"><meta property=og:url content=http://yangbingdong.com/2017/v2proxy/index.html><meta property=og:site_name content="ookamiAntD's Blog"><meta property=og:description content="Preface 作为一名开发人员, 日常离不开 Google, 那么在这之前, 必须要先学会如何代理. 本人 Linode 邀请码: 79e24952d46644605b071a55c4fda3b23e1d1a5a"><meta property=og:locale content=en><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/whats-shadowsocks-04.png><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/proxy.png><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/proxy01.png><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/proxy03.png><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/proxy04.png><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/privoxy-config01.png><meta property=og:image content=https://cdn.yangbingdong.com/img/vps/privoxy-config02.png><meta property=og:image content=https://cdn.yangbingdong.com/img/docker-shadowsocks/change-kernel.png><meta property=og:updated_time content=2020-08-14T10:50:24.188Z><meta name=twitter:card content=summary><meta name=twitter:title content="V2Proxy 正确的代理模式"><meta name=twitter:description content="Preface 作为一名开发人员, 日常离不开 Google, 那么在这之前, 必须要先学会如何代理. 本人 Linode 邀请码: 79e24952d46644605b071a55c4fda3b23e1d1a5a"><meta name=twitter:image content=https://cdn.yangbingdong.com/img/vps/whats-shadowsocks-04.png><script id=hexo.configurations>var NexT=window.NexT||{};var CONFIG={root:'/',scheme:'Muse',sidebar:{"position":"right","display":"always"},fancybox:true,motion:true,duoshuo:{userId:'undefined',author:'Author'},algolia:{applicationID:'RI3NF6GUI0',apiKey:'3d33fa60ba30d3b17f37220bb1a36749',indexName:'blogIndex',hits:{"per_page":10},labels:{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}};</script><link rel=canonical href=http://yangbingdong.com/2017/v2proxy/><script>(function(){if('admin123'){if(prompt('请输入文章密码')!=='admin123'){alert('密码错误！');history.back();}}})();</script><title>V2Proxy 正确的代理模式 | ookamiAntD's Blog</title><body itemscope itemtype=http://schema.org/WebPage lang=en><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?e9505ac4e11d464329d615553a72b526";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><div class="container one-collumn sidebar-position-right page-post-detail"><div class=headband></div><a href=https://github.com/masteranthoneyd/blog rel="external nofollow noopener noreferrer" target=_blank><img style=position:absolute;top:0;left:0;border:0 src=https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67 alt="Fork me on GitHub" data-canonical-src=https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png></a><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-meta><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span><span class=site-title>ookamiAntD's Blog</span>
<span class=logo-line-after><i></i></span></a></div><h1 class=site-subtitle itemprop=description>Easy coding,easy life.</h1></div><div class=site-nav-toggle><button>
<span class=btn-bar></span><span class=btn-bar></span><span class=btn-bar></span></button></div><nav class=site-nav><ul id=menu class=menu><li class="menu-item menu-item-home"><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a><li class="menu-item menu-item-archives"><a href=/archives rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a><li class="menu-item menu-item-categories"><a href=/categories rel=section><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a><li class="menu-item menu-item-tags"><a href=/tags rel=section><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a><li class="menu-item menu-item-about"><a href=/about rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a><li class="menu-item menu-item-guestbook"><a href=/guestbook rel=section><i class="menu-item-icon fa fa-fw fa-commenting"></i><br>Message</a><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></ul><div class=site-search><div class=popup><span class="search-icon fa fa-search"></span><input id=local-search-input><div id=local-search-result></div><span class=popup-btn-close>close</span></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><div id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><link itemprop=mainEntityOfPage href=http://yangbingdong.com/2017/v2proxy/><span style=display:none itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=name content=ookamiAntD><meta itemprop=description content><meta itemprop=image content=/images/avatar/avatar-admin.jpg></span><span style=display:none itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="ookamiAntD's Blog"><span style=display:none itemprop=logo itemscope itemtype=http://schema.org/ImageObject><img style=display:none itemprop="url image" alt="ookamiAntD's Blog" src></span></span><header class=post-header><h2 class=post-title itemprop="name headline">V2Proxy 正确的代理模式</h2><div class=post-meta><span class=post-time><span class=post-meta-item-icon><i class="fa fa-calendar-o"></i></span><span class=post-meta-item-text>Posted on</span>
<time title="Post created" itemprop="dateCreated datePublished" datetime=2017-04-19T18:15:57+08:00>2017-04-19</time></span>
<span class=post-category><span class=post-meta-divider>|</span>
<span class=post-meta-item-icon><i class="fa fa-folder-o"></i></span><span class=post-meta-item-text>In</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/VPS/ itemprop=url rel=index><span itemprop=name>VPS</span></a></span></span>
<span id=/2017/v2proxy/ class=leancloud_visitors data-flag-title="V2Proxy 正确的代理模式"><span class=post-meta-divider>|</span>
<span class=post-meta-item-icon><i class="fa fa-eye"></i></span><span class=post-meta-item-text>Visitors</span>
<span class=leancloud-visitors-count></span></span><br><span class=post-time><span class=post-meta-item-icon><i class="fa fa-edit"></i></span><span class=post-meta-item-text>WordCount:</span>
<span class=post-count>4,938字</span>
<span class=post-meta-divider>|</span>
<span class=post-meta-item-text>min2read:</span>
<span class=post-count>23分钟</span></span></div></header><div class=post-body itemprop=articleBody><link rel=stylesheet href=https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css><p><img src=https://cdn.yangbingdong.com/img/vps/whats-shadowsocks-04.png alt><h1 id=Preface><a href=#Preface class=headerlink title=Preface></a>Preface</h1><blockquote><p>作为一名开发人员, 日常离不开 Google, 那么在这之前, 必须要先学会如何代理.<p>本人 <strong><em><a href=https://www.linode.com/ rel="external nofollow noopener noreferrer" target=_blank>Linode</a></em></strong> 邀请码: <code>79e24952d46644605b071a55c4fda3b23e1d1a5a</code></blockquote><a id=more></a><h1 id=代理方式介绍><a href=#代理方式介绍 class=headerlink title=代理方式介绍></a>代理方式介绍</h1><blockquote><p>核心原理都一样, 如上方图所示. 推荐使用 <strong><em><a href=https://github.com/trojan-gfw/trojan rel="external nofollow noopener noreferrer" target=_blank>Trojan</a></em></strong>.</blockquote><ul><li><strong><em><a href=https://shadowsocks.org/ rel="external nofollow noopener noreferrer" target=_blank>Shadowsocks</a></em></strong>: 过去比较常用, 据说如今 GFW 已经能够识别出, 所以经常掉链子.<li><strong><em><a href=https://www.v2ray.com/ rel="external nofollow noopener noreferrer" target=_blank>V2ray</a></em></strong>: Go 语言开发的高性能网络工具集, 服务端客户端于一体, 功能比较多, 支持 Shadowsocks 协议, 属于目前比较流行的科学上网软件.<li><strong><em><a href=https://github.com/trojan-gfw/trojan rel="external nofollow noopener noreferrer" target=_blank>Trojan</a></em></strong>: 专门为绕过 GFW 而生的新一代科学上网软件, 由 C++ 编写, 需要域名以及证书伪装成 HTTPS.</ul><p>难度 | 稳定: <code>Shadowsocks</code> &lt; <code>V2ray</code> &lt; <code>Trojan</code><h1 id=VPS选择><a href=#VPS选择 class=headerlink title=VPS选择></a>VPS选择</h1><blockquote><p>VPS 厂商众多, 其他的我不多说.</blockquote><ul><li><strong><em><a href=https://www.linode.com rel="external nofollow noopener noreferrer" target=_blank>Linode</a></em></strong> VPS 大厂了, 价格不算便宜, 我用的5$每月, 稳定网速快, 推荐. 邀请码: <code>79e24952d46644605b071a55c4fda3b23e1d1a5a</code><li><strong><em><a href=https://bandwagonhost.com/ rel="external nofollow noopener noreferrer" target=_blank>BandwagonHOST</a></em></strong> 搬瓦工(已被墙), 便宜, 性价比高<li>阿里云香港ECS, 优点不说了, 缺点就是太贵, 如果只是查查资料或者玩游戏的, 可以买按流量计费的</ul><h1 id=准备工作><a href=#准备工作 class=headerlink title=准备工作></a>准备工作</h1><h2 id=准备一台VPS><a href=#准备一台VPS class=headerlink title=准备一台VPS></a>准备一台VPS</h2><p>博主选择<strong><em><a href=https://www.linode.com rel="external nofollow noopener noreferrer" target=_blank>Linode</a></em></strong><p>博主的邀请码: <code>79e24952d46644605b071a55c4fda3b23e1d1a5a</code><h2 id=SSH无密码登录VPS-可选><a href=#SSH无密码登录VPS-可选 class=headerlink title="SSH无密码登录VPS (可选)"></a>SSH无密码登录VPS (可选)</h2><p>参考 <strong><em><a href=/2017/note-of-linux-command/#免密码登录远程服务器>免密码登录远程服务器</a></em></strong><h1 id=各大代理安装与使用><a href=#各大代理安装与使用 class=headerlink title=各大代理安装与使用></a>各大代理安装与使用</h1><p>安装方式各种各样. . .同意 推荐使用 Docker 镜像安装.<h2 id=Shadowsocks><a href=#Shadowsocks class=headerlink title=Shadowsocks></a>Shadowsocks</h2><h3 id=服务端><a href=#服务端 class=headerlink title=服务端></a>服务端</h3><p>拉取镜像:<p><code>Showdowsocks</code>镜像: <strong><em><a href=https://hub.docker.com/r/mritd/shadowsocks/ rel="external nofollow noopener noreferrer" target=_blank>https://hub.docker.com/r/mritd/shadowsocks/</a></em></strong><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>docker pull mritd/shadowsocks:latest</span><br></pre></table></figure><p>运行:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>docker run -dt --name ssserver --restart=always -p 6443:6443 mritd/shadowsocks:latest -m &quot;ss-server&quot; -s &quot;-s 0.0.0.0 -p 6443 -m aes-256-cfb -k 123456 --fast-open&quot;</span><br></pre></table></figure><p>ss命令说明:<ul><li><code>-s</code> : 监听服务ip, 为服务器本地<li><code>-p</code> : 端口<li><code>-m</code> : 加密算法<li><code>-k</code> : 密码<li><code>--fast-open</code> : 开启TCP <code>fast-open</code></ul><h3 id=脚本一键安装><a href=#脚本一键安装 class=headerlink title=脚本一键安装></a>脚本一键安装</h3><blockquote><p>更多精彩被容请移步到 <strong><em><a href=https://teddysun.com/ rel="external nofollow noopener noreferrer" target=_blank>https://teddysun.com/</a></em></strong></blockquote><p>root用户执行:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>wget --no-check-certificate -O shadowsocks-all.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh</span><br><span class=line>chmod +x shadowsocks-all.sh</span><br><span class=line>./shadowsocks-all.sh 2&gt;&amp;1 | tee shadowsocks-all.log</span><br></pre></table></figure><p>安装完成后, 脚本提示如下:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line>Congratulations, your_shadowsocks_version install completed!</span><br><span class=line>Your Server IP        :your_server_ip</span><br><span class=line>Your Server Port      :your_server_port</span><br><span class=line>Your Password         :your_password</span><br><span class=line>Your Encryption Method:your_encryption_method</span><br><span class=line></span><br><span class=line>Your QR Code: (For Shadowsocks Windows, OSX, Android and iOS clients)</span><br><span class=line> ss://your_encryption_method:your_password@your_server_ip:your_server_port</span><br><span class=line>Your QR Code has been saved as a PNG file path:</span><br><span class=line> your_path.png</span><br><span class=line></span><br><span class=line>Welcome to visit:https://teddysun.com/486.html</span><br><span class=line>Enjoy it!</span><br></pre></table></figure><p>卸载方法:<p>若已安装多个版本, 则卸载时也需多次运行（每次卸载一种）<p>使用root用户登录, 运行以下命令:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>./shadowsocks-all.sh uninstall</span><br></pre></table></figure><p>启动脚本:<p>启动脚本后面的参数含义, 从左至右依次为: 启动, 停止, 重启, 查看状态.<p><strong>Shadowsocks-Python</strong> 版:<br><code>/etc/init.d/shadowsocks-python start | stop | restart | status</code><p><strong>ShadowsocksR</strong> 版:<br><code>/etc/init.d/shadowsocks-r start | stop | restart | status</code><p><strong>Shadowsocks-Go</strong> 版:<br><code>/etc/init.d/shadowsocks-go start | stop | restart | status</code><p><strong>Shadowsocks-libev</strong> 版:<br><code>/etc/init.d/shadowsocks-libev start | stop | restart | status</code><p>各版本默认配置文件:<p><strong>Shadowsocks-Python</strong> 版:<br><code>/etc/shadowsocks-python/config.json</code><p><strong>ShadowsocksR</strong> 版:<br><code>/etc/shadowsocks-r/config.json</code><p><strong>Shadowsocks-Go</strong> 版:<br><code>/etc/shadowsocks-go/config.json</code><p><strong>Shadowsocks-libev</strong> 版:<br><code>/etc/shadowsocks-libev/config.json</code><h3 id=客户端><a href=#客户端 class=headerlink title=客户端></a>客户端</h3><p>官网各大客户端: <strong><em><a href=https://shadowsocks.org/en/download/clients.html rel="external nofollow noopener noreferrer" target=_blank>https://shadowsocks.org/en/download/clients.html</a></em></strong><p>Docker 客户端:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>docker run -dt --name ssclient --restart=always -p 1080:1080 mritd/shadowsocks:latest -m &quot;ss-local&quot; -s &quot;-s server-ip -p 6443 -b 0.0.0.0 -l 1080 -m aes-256-cfb -k 123456 --fast-open&quot;</span><br></pre></table></figure><h3 id=多用户管理><a href=#多用户管理 class=headerlink title=多用户管理></a>多用户管理</h3><p><strong><em><a href=https://github.com/mmmwhy/ss-panel-and-ss-py-mu rel="external nofollow noopener noreferrer" target=_blank>https://github.com/mmmwhy/ss-panel-and-ss-py-mu</a></em></strong> :<p><strong><em><a href=https://github.com/Ehco1996/django-sspanel rel="external nofollow noopener noreferrer" target=_blank>https://github.com/Ehco1996/django-sspanel</a></em></strong><p><strong><em><a href=https://github.com/iMeiji/shadowsocks_install/wiki/%E6%90%AD%E5%BB%BA-sspanel-v3-%E9%AD%94%E6%94%B9%E7%89%88%E8%AE%B0%E5%BD%95 rel="external nofollow noopener noreferrer" target=_blank>搭建-sspanel-v3-魔改版记录</a></em></strong><p><strong><em><a href=https://91vps.win/ rel="external nofollow noopener noreferrer" target=_blank>https://91vps.win/</a></em></strong><h2 id=V2Ray><a href=#V2Ray class=headerlink title=V2Ray></a>V2Ray</h2><blockquote><p>项目地址: <strong><em><a href=https://github.com/v2ray/v2ray-core rel="external nofollow noopener noreferrer" target=_blank>https://github.com/v2ray/v2ray-core</a></em></strong><p>参考文档: <strong><em><a href=https://toutyrater.github.io/ rel="external nofollow noopener noreferrer" target=_blank>https://toutyrater.github.io/</a></em></strong> (已被墙)<p>一键安装:<br><strong><em><a href=https://github.com/Jrohy/multi-v2ray rel="external nofollow noopener noreferrer" target=_blank>https://github.com/Jrohy/multi-v2ray</a></em></strong><br><strong><em><a href=https://github.com/233boy/v2ray rel="external nofollow noopener noreferrer" target=_blank>https://github.com/233boy/v2ray</a></em></strong></blockquote><h3 id=服务端-1><a href=#服务端-1 class=headerlink title=服务端></a>服务端</h3><p><code>docker-compose.yml</code>:<figure class="highlight yaml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=attr>version:</span> <span class=string>'3.7'</span></span><br><span class=line><span class=attr>services:</span></span><br><span class=line>  <span class=attr>v2ray:</span></span><br><span class=line>    <span class=attr>image:</span> <span class=string>v2ray/official</span></span><br><span class=line>    <span class=attr>container_name:</span> <span class=string>v2ray</span></span><br><span class=line>    <span class=attr>restart:</span> <span class=string>always</span></span><br><span class=line>    <span class=attr>ports:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>"443:443"</span></span><br><span class=line></span><br><span class=line>    <span class=attr>volumes:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>./config.json:/etc/v2ray/config.json</span></span><br><span class=line>    <span class=attr>command:</span> <span class=string>v2ray</span> <span class=string>-config=/etc/v2ray/config.json</span></span><br></pre></table></figure><p><code>config.json</code>:<figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre><td class=code><pre><span class=line>&#123;</span><br><span class=line>    <span class=attr>"inbounds"</span>:[</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>"port"</span>:<span class=number>443</span>,</span><br><span class=line>            <span class=attr>"protocol"</span>:<span class=string>"vmess"</span>,</span><br><span class=line>            <span class=attr>"settings"</span>:&#123;</span><br><span class=line>                <span class=attr>"clients"</span>:[</span><br><span class=line>                    &#123;</span><br><span class=line>                        <span class=attr>"id"</span>:<span class=string>"b371a709-f63c-42d7-88bf-2a67cff72267"</span>,</span><br><span class=line>                        <span class=attr>"alterId"</span>:<span class=number>64</span></span><br><span class=line>                    &#125;</span><br><span class=line>                ]</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    ],</span><br><span class=line>    <span class=attr>"outbounds"</span>:[</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>"protocol"</span>:<span class=string>"freedom"</span>,</span><br><span class=line>            <span class=attr>"settings"</span>:&#123;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    ]</span><br><span class=line>&#125;</span><br></pre></table></figure><h3 id=客户端-1><a href=#客户端-1 class=headerlink title=客户端></a>客户端</h3><p><code>docker-compose.yml</code>:<figure class="highlight yaml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=attr>version:</span> <span class=string>'3.7'</span></span><br><span class=line><span class=attr>services:</span></span><br><span class=line>  <span class=attr>v2ray:</span></span><br><span class=line>    <span class=attr>image:</span> <span class=string>v2ray/official</span></span><br><span class=line>    <span class=attr>container_name:</span> <span class=string>v2ray</span></span><br><span class=line>    <span class=attr>restart:</span> <span class=string>always</span></span><br><span class=line>    <span class=attr>ports:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>"1080:1080"</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>"1080:1080/udp"</span></span><br><span class=line>    <span class=attr>volumes:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>./client-config.json:/etc/v2ray/config.json</span></span><br><span class=line>    <span class=attr>command:</span> <span class=string>["v2ray",</span> <span class=string>"-config=/etc/v2ray/config.json"</span><span class=string>]</span></span><br></pre></table></figure><p><code>client-config.json</code>:<figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br></pre><td class=code><pre><span class=line>&#123;</span><br><span class=line>    <span class=attr>"inbounds"</span>:[</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>"port"</span>:<span class=number>1080</span>,</span><br><span class=line>            <span class=attr>"protocol"</span>:<span class=string>"socks"</span>,</span><br><span class=line>            <span class=attr>"sniffing"</span>:&#123;</span><br><span class=line>                <span class=attr>"enabled"</span>:<span class=literal>true</span>,</span><br><span class=line>                <span class=attr>"destOverride"</span>:[</span><br><span class=line>                    <span class=string>"http"</span>,</span><br><span class=line>                    <span class=string>"tls"</span></span><br><span class=line>                ]</span><br><span class=line>            &#125;,</span><br><span class=line>            <span class=attr>"settings"</span>:&#123;</span><br><span class=line>                <span class=attr>"auth"</span>:<span class=string>"noauth"</span></span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    ],</span><br><span class=line>    <span class=attr>"outbounds"</span>:[</span><br><span class=line>        &#123;</span><br><span class=line>            <span class=attr>"protocol"</span>:<span class=string>"vmess"</span>,</span><br><span class=line>            <span class=attr>"settings"</span>:&#123;</span><br><span class=line>                <span class=attr>"vnext"</span>:[</span><br><span class=line>                    &#123;</span><br><span class=line>                        <span class=attr>"address"</span>:<span class=string>"123.456.678.0"</span>,</span><br><span class=line>                        <span class=attr>"port"</span>:<span class=number>443</span>,</span><br><span class=line>                        <span class=attr>"users"</span>:[</span><br><span class=line>                            &#123;</span><br><span class=line>                                <span class=attr>"id"</span>:<span class=string>"b371a709-f63c-42d7-88bf-2a67cff72267"</span>,</span><br><span class=line>                                <span class=attr>"alterId"</span>:<span class=number>64</span></span><br><span class=line>                            &#125;</span><br><span class=line>                        ]</span><br><span class=line>                    &#125;</span><br><span class=line>                ],</span><br><span class=line>                <span class=attr>"mux"</span>:&#123;</span><br><span class=line>                    <span class=attr>"enabled"</span>:<span class=literal>true</span></span><br><span class=line>                &#125;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    ]</span><br><span class=line>&#125;</span><br></pre></table></figure><p>其他客户端:<ul><li>跨平台 UI 客户端: <strong><em><a href=https://github.com/Qv2ray/Qv2ray rel="external nofollow noopener noreferrer" target=_blank>Qv2ray</a></em></strong><li>MAC 客户端: <strong><em><a href=https://github.com/yanue/V2rayU/tree/master rel="external nofollow noopener noreferrer" target=_blank>V2rayU</a></em></strong></ul><h3 id=多用户管理UI><a href=#多用户管理UI class=headerlink title=多用户管理UI></a>多用户管理UI</h3><p><strong><em><a href=https://blog.sprov.xyz/2019/08/03/v2-ui/ rel="external nofollow noopener noreferrer" target=_blank>https://blog.sprov.xyz/2019/08/03/v2-ui/</a></em></strong><h2 id=Trajon><a href=#Trajon class=headerlink title=Trajon></a>Trajon</h2><h3 id=服务端-2><a href=#服务端-2 class=headerlink title=服务端></a>服务端</h3><p><strong><em><a href=https://www.atrandys.com/category/kxsw/trojan rel="external nofollow noopener noreferrer" target=_blank>https://www.atrandys.com/category/kxsw/trojan</a></em></strong> / <strong><em><a href=https://github.com/atrandys/trojan rel="external nofollow noopener noreferrer" target=_blank>https://github.com/atrandys/trojan</a></em></strong><p><strong><em><a href=https://github.com/mark-logs-code-hub/trojan-wiz rel="external nofollow noopener noreferrer" target=_blank>https://github.com/mark-logs-code-hub/trojan-wiz</a></em></strong><p>或者是一下我写的…:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>wget -N --no-check-certificate &apos;https://raw.githubusercontent.com/masteranthoneyd/about-shell/master/trojan.sh&apos; &amp;&amp; chmod +x trojan.sh &amp;&amp; ./trojan.sh $DOMAIN</span><br></pre></table></figure><p>将 <code>$DOMAIN</code> 换成自己的域名.<h3 id=客户端-2><a href=#客户端-2 class=headerlink title=客户端></a>客户端</h3><p><code>docker-compose.yml</code>:<figure class="highlight yml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=attr>version:</span> <span class=string>'3.7'</span></span><br><span class=line><span class=attr>services:</span></span><br><span class=line>  <span class=attr>v2ray:</span></span><br><span class=line>    <span class=attr>image:</span> <span class=string>trojangfw/trojan</span></span><br><span class=line>    <span class=attr>container_name:</span> <span class=string>trojan</span></span><br><span class=line>    <span class=attr>restart:</span> <span class=string>always</span></span><br><span class=line>    <span class=attr>ports:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>"1081:1080"</span></span><br><span class=line>    <span class=attr>volumes:</span></span><br><span class=line>      <span class=bullet>-</span> <span class=string>./config:/config</span></span><br></pre></table></figure><p><code>config</code> 文件夹中应该包含Json配置文件以及证书.<p><code>config.json</code>:<figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre><td class=code><pre><span class=line>&#123;</span><br><span class=line>    <span class=attr>"run_type"</span>: <span class=string>"client"</span>,</span><br><span class=line>    <span class=attr>"local_addr"</span>: <span class=string>"0.0.0.0"</span>,</span><br><span class=line>    <span class=attr>"local_port"</span>: <span class=number>1080</span>,</span><br><span class=line>    <span class=attr>"remote_addr"</span>: <span class=string>"YOUR_DOMAIN"</span>,</span><br><span class=line>    <span class=attr>"remote_port"</span>: <span class=number>443</span>,</span><br><span class=line>    <span class=attr>"password"</span>: [</span><br><span class=line>        <span class=string>"YOUR_PASSWORD"</span></span><br><span class=line>    ],</span><br><span class=line>    <span class=attr>"log_level"</span>: <span class=number>1</span>,</span><br><span class=line>    <span class=attr>"ssl"</span>: &#123;</span><br><span class=line>        <span class=attr>"verify"</span>: <span class=literal>true</span>,</span><br><span class=line>        <span class=attr>"verify_hostname"</span>: <span class=literal>true</span>,</span><br><span class=line>        <span class=attr>"cert"</span>: <span class=string>"fullchain.cer"</span>,</span><br><span class=line>        <span class=attr>"cipher_tls13"</span>:<span class=string>"TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384"</span>,</span><br><span class=line><span class=attr>"sni"</span>: <span class=string>""</span>,</span><br><span class=line>        <span class=attr>"alpn"</span>: [</span><br><span class=line>            <span class=string>"h2"</span>,</span><br><span class=line>            <span class=string>"http/1.1"</span></span><br><span class=line>        ],</span><br><span class=line>        <span class=attr>"reuse_session"</span>: <span class=literal>true</span>,</span><br><span class=line>        <span class=attr>"session_ticket"</span>: <span class=literal>false</span>,</span><br><span class=line>        <span class=attr>"curves"</span>: <span class=string>""</span></span><br><span class=line>    &#125;,</span><br><span class=line>    <span class=attr>"tcp"</span>: &#123;</span><br><span class=line>        <span class=attr>"no_delay"</span>: <span class=literal>true</span>,</span><br><span class=line>        <span class=attr>"keep_alive"</span>: <span class=literal>true</span>,</span><br><span class=line>        <span class=attr>"fast_open"</span>: <span class=literal>true</span>,</span><br><span class=line>        <span class=attr>"fast_open_qlen"</span>: <span class=number>20</span></span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></table></figure><h2 id=Just-My-Socks><a href=#Just-My-Socks class=headerlink title="Just My Socks"></a>Just My Socks</h2><p>搬瓦工官方机场: <strong><em><a href=https://justmysocks.net/ rel="external nofollow noopener noreferrer" target=_blank>https://justmysocks.net/</a></em></strong><p>使用: <strong><em><a href=https://blog.shuziyimin.org/840 rel="external nofollow noopener noreferrer" target=_blank>https://blog.shuziyimin.org/840</a></em></strong><h1 id=将流量转发到代理><a href=#将流量转发到代理 class=headerlink title=将流量转发到代理></a>将流量转发到代理</h1><p>上面所介绍的代理软件基本上客户端都是<strong>监听本地1080端口</strong>, 并且是 <strong>Sock5</strong> 协议, 所以需要将 HTTP 流量<strong>转发</strong>到本地的1080端口. 好处是<strong>解耦了代理的实现</strong>, 可以<strong>随时更换代理软件</strong>, 比如将 V2ray 换成 Trojan, 只需要更换客户端.<h2 id=浏览器转发><a href=#浏览器转发 class=headerlink title=浏览器转发></a>浏览器转发</h2><p>推荐使用 Chrome 或者使用 Chrome 内核的浏览器如360. 其他浏览器自行研究.<p>这种方式适合所有桌面版系统平台, 有些代理客户端可以设置全局流量转发比如 Windows 的 <strong><em><a href=https://github.com/shadowsocks/shadowsocks-windows rel="external nofollow noopener noreferrer" target=_blank>shadowsocks-win</a></em></strong>, 不建议将全局流量转发作为常用设置, 不好控制. 而使用浏览器插件可控度高, 有些网站没有被墙比如 Github, 但是加载速度比较慢, 可在浏览器中直接强制走代理.<h3 id=SwitchyOmega插件安装><a href=#SwitchyOmega插件安装 class=headerlink title=SwitchyOmega插件安装></a>SwitchyOmega插件安装</h3><p><strong><em><a href=https://github.com/FelisCatus/SwitchyOmega rel="external nofollow noopener noreferrer" target=_blank>SwitchyOmega</a></em></strong> 可以将浏览器的流量转发到我们本地的 Socks5 端口.<p>安装方式:<ul><li>从 <strong><em><a href=https://chrome.google.com/webstore/detail/padekgcemlokbadohgkifijomclgjgif rel="external nofollow noopener noreferrer" target=_blank>Chrome Web Store</a></em></strong> 下载, 首先你得能访问 Google, 这是一个<strong>悖论</strong><li>从 <strong><em><a href=https://github.com/FelisCatus/SwitchyOmega/releases/ rel="external nofollow noopener noreferrer" target=_blank>Releases</a></em></strong> 页面下载离线安装包, 浏览器地址打开<code>chrome://extensions/</code>, 启用<strong>开发者模式</strong>,将下载的安装包拖进去<li>无法安装的参考一下这里: <strong><em><a href=https://zhuanlan.zhihu.com/p/78519194 rel="external nofollow noopener noreferrer" target=_blank>四种谷歌浏览器扩展插件安装方法，完美解决程序包无效问题！</a></em></strong></ul><h3 id=设置代理地址><a href=#设置代理地址 class=headerlink title=设置代理地址></a>设置代理地址</h3><p>安装好插件会自动跳到设置选项, 有提示你可以跳过. 左边新建情景模式-选择代理服务器-比如命名为shadowProxy（叫什么无所谓）其他默认之后创建, 之后在代理协议选择 SOCKS5, 地址为<code>127.0.0.1</code>,端口默认<code>1080</code> . 然后保存即应用选项.<br><img src=https://cdn.yangbingdong.com/img/vps/proxy.png alt><br><img src=https://cdn.yangbingdong.com/img/vps/proxy01.png alt><h3 id=设置自动切换><a href=#设置自动切换 class=headerlink title=设置自动切换></a>设置自动切换</h3><p>接着点击自动切换 ( Auto switch）上面的不用管, 在按照规则列表匹配请求后面选择刚才新建的SS, 默认情景模式选择直接连接. 点击应用选项保存. 再往下规则列表设置选择<code>AutoProxy</code> 然后将 <em><a href=https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt rel="external nofollow noopener noreferrer" target=_blank>https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a></em> 填进去, 点击下面的立即更新情景模式, 会有提示更新成功！<br><img src=https://cdn.yangbingdong.com/img/vps/proxy03.png alt><p>点击浏览器右上角的 SwitchyOmega 图标, 下面选择自动切换, 然后打开 <strong><em><a href=https://www.google.com/ rel="external nofollow noopener noreferrer" target=_blank>google.com</a></em></strong> 试试, 其他的就不在这贴图了.<br><img src=https://cdn.yangbingdong.com/img/vps/proxy04.png alt><h2 id=GenPAC全局代理><a href=#GenPAC全局代理 class=headerlink title=GenPAC全局代理></a>GenPAC全局代理</h2><p>如果不想每个浏览器都要设置代理, 可以通过GenPAC实现全局代理.<h3 id=安装><a href=#安装 class=headerlink title=安装></a>安装</h3><p>pip:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>sudo apt-get install python-pip python-dev build-essential </span><br><span class=line>sudo pip install --upgrade pip </span><br><span class=line>sudo pip install --upgrade virtualenv</span><br></pre></table></figure><p>GenPAC:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>sudo pip install genpac</span><br><span class=line>sudo pip install --upgrade genpac</span><br></pre></table></figure><h3 id=设置全局代理><a href=#设置全局代理 class=headerlink title=设置全局代理></a>设置全局代理</h3><p>1、进入终端, Ctrl+Alt+T, cd到你希望生成文件存放的位置.<br>例如:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>cd /home/ybd/Data/application/shadowsocks</span><br></pre></table></figure><p>2、执行下面的语句:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sudo genpac --proxy="SOCKS5 127.0.0.1:1080" --gfwlist-proxy="SOCKS5 127.0.0.1:1080" -o autoproxy.pac --gfwlist-url="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt"</span><br></pre></table></figure><p><strong>注意</strong>:<br>上面语句中<code>127.0.0.1:1080</code>应按照自己的情况填写.<br>如果出现下面这种报错:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>fetch gfwlist fail. online: https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt local: None</span><br></pre></table></figure><p>那么换成执行下面的语句:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sudo genpac --proxy="SOCKS5 127.0.0.1:1080" -o autoproxy.pac --gfwlist-url="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt"</span><br></pre></table></figure><p>如果出现<code>base64 decoding fail .</code>, 安装其他版本:<br><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>sudo pip install https://github.com/JinnLynn/genpac/archive/master.zip</span><br><span class=line>sudo pip install --upgrade https://github.com/JinnLynn/genpac/archive/master.zip</span><br><span class=line>sudo pip uninstall genpac</span><br></pre></table></figure><p>3、全局代理<br>系统设置 –&gt; 网络 –&gt; 网络代理<br>“方法”选择“自动”<br>“配置URL”填写:<br><code>file:///home/ybd/Data/application/shadowsocks/autoproxy.pac</code><br>点击“应用到整个系统”, 接下来可以愉悦的跨过墙了～<h2 id=Proxychains-代理><a href=#Proxychains-代理 class=headerlink title="Proxychains 代理"></a>Proxychains 代理</h2><blockquote><p><strong><em><a href=https://github.com/rofl0r/proxychains-ng rel="external nofollow noopener noreferrer" target=_blank>https://github.com/rofl0r/proxychains-ng</a></em></strong><p>这个是最新版的proxychains, 下面通过apt安装的是3.1版本的.</blockquote><p>安装proxychains:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>sudo apt install proxychains</span><br><span class=line></span><br><span class=line><span class=meta>#</span><span class=bash> 最新版为 sudo apt install proxychains4, 配置文件在/etc/proxychains4.conf, 命令为proxychains4</span></span><br></pre></table></figure><p>配置proxychains:<br>编辑<code>/etc/proxychains.conf</code>, 最下面有一行<code>socks4 127.0.0.1 9050</code>, 把这一行注释掉, 添加一行<code>socks5 127.0.0.1 1080</code><br>测试:<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>proxychains curl www.google.com</span><br></pre></table></figure><p>使用:<br>用命令行启动软件, 在前面加上proxychains, 如:<br><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>proxychains firefox</span><br></pre></table></figure><p>使用<code>shadowsocks</code>+<code>proxychains</code>代理打开新的Firefox实现浏览器翻墙.<br>也可以通过输入<code>proxychains bash</code>建立一个新的<code>shell</code>, 基于这个<code>shell</code>运行的所有命令都将使用代理.<blockquote><p>如果需要配置<strong>不输出代理信息</strong>, 编辑 <code>/etc/proxychains.conf</code> 将 <code>#quiet_mode</code> 改为 <code>quiet_mode</code>.</blockquote><h2 id=Privoxy><a href=#Privoxy class=headerlink title=Privoxy></a>Privoxy</h2><p>Privoxy是一款带过滤功能的代理服务器, 针对HTTP、HTTPS协议. 通过Privoxy的过滤功能, 用户可以保护隐私、对网页内容进行过滤、管理cookies, 以及拦阻各种广告等. Privoxy可以用作单机, 也可以应用到多用户的网络.<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sudo apt install privoxy</span><br></pre></table></figure><p>安装好后进行配置, Privoxy的配置文件在<code>/etc/privoxy/config</code>, 这个配置文件中注释很多.<p>找到<code>4.1. listen-address</code>这一节, 确认监听的端口号, 如果有内网地址可以监听 <code>0.0.0.0:8118</code>.<p><img src=https://cdn.yangbingdong.com/img/vps/privoxy-config01.png alt><p>找到<code>5.2. forward-socks4, forward-socks4a, forward-socks5 and forward-socks5t</code>这一节, 加上如下配置, 注意最后的点号.<p><img src=https://cdn.yangbingdong.com/img/vps/privoxy-config02.png alt><p>重启一下Privoxy<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sudo /etc/init.d/privoxy restart</span><br></pre></table></figure><p>终端体验:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>export http_proxy=&quot;127.0.0.1:8118&quot; &amp;&amp; export https_proxy=&quot;127.0.0.1:8118&quot;</span><br><span class=line>wget http://www.google.com</span><br></pre></table></figure><p>在<code>/etc/profile</code>的末尾添加如下两句.<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>export http_proxy=&quot;127.0.0.1:8118&quot;</span><br><span class=line>export https_proxy=&quot;127.0.0.1:8118&quot;</span><br></pre></table></figure><h1 id=网络优化><a href=#网络优化 class=headerlink title=网络优化></a>网络优化</h1><h2 id=Google-BBR><a href=#Google-BBR class=headerlink title="Google BBR"></a>Google BBR</h2><p><strong><em><a href=https://teddysun.com/489.html rel="external nofollow noopener noreferrer" target=_blank>一键安装最新内核并开启 BBR 脚本</a></em></strong>:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh &amp;&amp; chmod +x bbr.sh &amp;&amp; ./bbr.sh</span><br></pre></table></figure><p>或者使用下面这个开始 BBR+.<p><strong><em><a href=https://github.com/chiakge/Linux-NetSpeed rel="external nofollow noopener noreferrer" target=_blank>https://github.com/chiakge/Linux-NetSpeed</a></em></strong> :<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>wget -N --no-check-certificate &quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot; &amp;&amp; chmod +x tcp.sh &amp;&amp; ./tcp.sh</span><br></pre></table></figure><h3 id=更换Linode内核><a href=#更换Linode内核 class=headerlink title=更换Linode内核></a>更换Linode内核</h3><p>谷歌开发的TCP加速外挂, 目前已集成到最新的Linux内核.<br><strong><a href=https://www.linode.com/ rel="external nofollow noopener noreferrer" target=_blank>Linode</a></strong> 不能直接命令更换内核, 需要到管理后台设置:<br><img src=https://cdn.yangbingdong.com/img/docker-shadowsocks/change-kernel.png alt><p>安装完重启后输入<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>lsmod | grep bbr</span><br></pre></table></figure><p>出现 <code>tcp_bbr</code> 即说明 BBR 已经启动.<h3 id=手动安装><a href=#手动安装 class=headerlink title=手动安装></a>手动安装</h3><p>如果是最新内核:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class=line>echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class=line>sysctl -p</span><br></pre></table></figure><h2 id=开启TCP-Fast-Open><a href=#开启TCP-Fast-Open class=headerlink title="开启TCP Fast Open"></a>开启TCP Fast Open</h2><p>这个需要服务器和客户端都是Linux 3.7+的内核, 一般Linux的服务器发行版只有debian jessie有3.7+的, 客户端用Linux更是珍稀动物, 所以这个不多说, 如果你的服务器端和客户端都是Linux 3.7+的内核, 那就在<strong>服务端</strong>和<strong>客户端</strong>的<code>vi /etc/sysctl.conf</code>文件中再加上一行.<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>echo &quot;net.ipv4.tcp_fastopen = 3&quot; | sudo tee -a /etc/sysctl.conf</span><br><span class=line>echo &quot;3&quot; | sudo tee /proc/sys/net/ipv4/tcp_fastopen</span><br><span class=line>sudo sysctl -p</span><br></pre></table></figure><p>然后把<code>vi /etc/shadowsocks.json</code>配置文件中<code>&quot;fast_open&quot;: false</code>改为<code>&quot;fast_open&quot;: true</code>. 这样速度也将会有非常显著的提升.<h2 id=TCP优化><a href=#TCP优化 class=headerlink title=TCP优化></a>TCP优化</h2><p>1.修改文件句柄数限制<br>如果是ubuntu/centos均可修改<code>/etc/sysctl.conf</code><br>找到<code>fs.file-max</code>这一行, 修改其值为<code>1024000</code>, 并保存退出. 然后执行<code>sysctl -p</code>使其生效<br>修改<code>vi /etc/security/limits.conf</code>文件, 加入<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>*               soft    nofile           512000</span><br><span class=line>*               hard    nofile          1024000</span><br></pre></table></figure><p>针对centos,还需要修改<code>vi /etc/pam.d/common-session</code>文件, 加入<br><code>session required pam_limits.so</code><p>2.修改<code>vi /etc/profile</code>文件, 加入<br><code>ulimit -SHn 1024000</code><br>然后重启服务器执行<code>ulimit -n</code>, 查询返回1024000即可.<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>sysctl.conf报错解决方法</span><br><span class=line>修复modprobe的: </span><br><span class=line>rm -f /sbin/modprobe </span><br><span class=line>ln -s /bin/true /sbin/modprobe</span><br><span class=line>修复sysctl的: </span><br><span class=line>rm -f /sbin/sysctl </span><br><span class=line>ln -s /bin/true /sbin/sysctl</span><br></pre></table></figure><h2 id=使用特殊端口><a href=#使用特殊端口 class=headerlink title=使用特殊端口></a>使用特殊端口</h2><p>GFW会通过某些手段来减轻数据过滤的负荷, 例如特殊的端口如ssh, ssh默认端口给ss用了那么久必须修改我们登录服务器的端口.<br>修改SSH配置文件:<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>vi /etc/ssh/sshd_config</span><br></pre></table></figure><p>找到<code>#port 22</code>, 将前面的<code>#</code>去掉, 然后修改端口 <code>port 2333</code>（自己设定）.<br>然后重启SSH:<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>service ssh restart</span><br></pre></table></figure><h1 id=VPS-Security><a href=#VPS-Security class=headerlink title="VPS Security"></a>VPS Security</h1><h2 id=修改SSH登录端口><a href=#修改SSH登录端口 class=headerlink title=修改SSH登录端口></a>修改SSH登录端口</h2><h3 id=Ubuntu><a href=#Ubuntu class=headerlink title=Ubuntu></a>Ubuntu</h3><p>1、用下面命令进入配置文件<code>vi /etc/ssh/sshd_config</code><br>2、找到<code>#port 22</code>, 将前面的<code>#</code>去掉, 然后修改端口 <code>port 12345</code>（自己设定）.<br>3、然后重启ssh服务<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>#Debian/ubuntu  /etc/init.d/ssh restart   or    service ssh restart</span><br><span class=line>#CentOS         service sshd restart</span><br></pre></table></figure><h3 id=CentOS><a href=#CentOS class=headerlink title=CentOS></a>CentOS</h3><p>1、临时关闭SELinux:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>setenforce 0</span><br></pre></table></figure><p>2、修改SSH端口<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line>vi /etc/ssh/sshd_config</span><br><span class=line></span><br><span class=line>#在Port 22下面加一行, 以端口2333为例, Port 2333</span><br><span class=line></span><br><span class=line>#重启ssh服务: </span><br><span class=line>systemctl restart sshd.service</span><br></pre></table></figure><p>3、防火墙中放行新加入端口<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>firewall-cmd --permanent --add-port=2333/tcp</span><br></pre></table></figure><p>4、用该命令查询<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>firewall-cmd --permanent --query-port=2333/tcp</span><br></pre></table></figure><p>如果是<code>yes</code>就是添加成功, 如果是no就是没成功<p>5、成功后重载防火墙<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>firewall-cmd --reload</span><br></pre></table></figure><p>6、关闭SELinux<p>查看SELinux状态<code>SELINUX</code>, 如果是<code>enabled</code>就是开启状态<p><code>vi /etc/selinux/config</code><p>修改<code>SELINUX=disabled</code><p>最后重启vps试试用新的<code>2333</code>端口登录, 如果登录成功再<code>vi /etc/ssh/sshd_config</code>把<code>Port 22</code>端口删除, 再重启ssh服务就好了.<h2 id=使用密钥登录SSH><a href=#使用密钥登录SSH class=headerlink title=使用密钥登录SSH></a>使用密钥登录SSH</h2><p>1、服务端生成密钥<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br></pre><td class=code><pre><span class=line>#生成SSH密钥对</span><br><span class=line>ssh-keygen -t rsa</span><br><span class=line></span><br><span class=line>Generating public/private rsa key pair.</span><br><span class=line>#建议直接回车使用默认路径</span><br><span class=line>Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class=line>#输入密码短语（留空则直接回车）</span><br><span class=line>Enter passphrase (empty for no passphrase): </span><br><span class=line>#重复密码短语</span><br><span class=line>Enter same passphrase again: </span><br><span class=line>Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class=line>Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class=line>The key fingerprint is:</span><br><span class=line>aa:8b:61:13:38:ad:b5:49:ca:51:45:b9:77:e1:97:e1 root@localhost.localdomain</span><br><span class=line>The key&apos;s randomart image is:</span><br><span class=line>+--[ RSA 2048]----+</span><br><span class=line>|    .o.          |</span><br><span class=line>|    ..   . .     |</span><br><span class=line>|   .  . . o o    |</span><br><span class=line>| o.  . . o E     |</span><br><span class=line>|o.=   . S .      |</span><br><span class=line>|.*.+   .         |</span><br><span class=line>|o.*   .          |</span><br><span class=line>| . + .           |</span><br><span class=line>|  . o.           |</span><br><span class=line>+-----------------+</span><br></pre></table></figure><p>2、复制密钥对<blockquote><p>也可以手动在客户端建立目录和authorized_keys, 注意修改权限</blockquote><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>#复制公钥到无密码登录的服务器上,22端口改变可以使用下面的命令</span><br><span class=line>#ssh-copy-id -i ~/.ssh/id_rsa.pub &quot;-p 10022 user@server&quot;</span><br><span class=line>ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.15.241</span><br></pre></table></figure><p>3、关闭密码登陆(编辑<code>/etc/ssh/sshd_config</code>)<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>#禁用密码验证</span><br><span class=line>PasswordAuthentication no</span><br><span class=line></span><br><span class=line>#启用密钥验证</span><br><span class=line>RSAAuthentication yes</span><br><span class=line>PubkeyAuthentication yes</span><br><span class=line></span><br><span class=line>#指定公钥数据库文件</span><br><span class=line>AuthorizedKeysFile .ssh/authorized_keys</span><br><span class=line></span><br><span class=line>#root 用户能否通过 SSH 登录</span><br><span class=line>PermitRootLogin yes</span><br></pre></table></figure><p>4、重启SSH<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line>#RHEL/CentOS系统</span><br><span class=line>service sshd restart</span><br><span class=line>#ubuntu系统</span><br><span class=line>service ssh restart</span><br><span class=line>#debian系统</span><br><span class=line>/etc/init.d/ssh restart</span><br></pre></table></figure><h2 id=防火墙><a href=#防火墙 class=headerlink title=防火墙></a>防火墙</h2><h3 id=Ubuntu防火墙UFW><a href=#Ubuntu防火墙UFW class=headerlink title=Ubuntu防火墙UFW></a>Ubuntu防火墙UFW</h3><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>ufw enable</span><br><span class=line>ufw allow ssh</span><br><span class=line>ufw allow [shadowsocks_port]</span><br><span class=line>ufw allow from [remote_ip]</span><br></pre></table></figure><h3 id=CentOS-1><a href=#CentOS-1 class=headerlink title=CentOS></a>CentOS</h3><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre><td class=code><pre><span class=line># 显示状态</span><br><span class=line>firewall-cmd --state</span><br><span class=line></span><br><span class=line># 启用</span><br><span class=line>systemctl start firewalld.service</span><br><span class=line></span><br><span class=line># Postgresql端口设置. 允许192.168.142.166访问5432端口</span><br><span class=line>firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.142.166&quot; port protocol=&quot;tcp&quot; port=&quot;5432&quot; accept&quot;</span><br><span class=line></span><br><span class=line># redis端口设置. 允许192.168.142.166访问6379端口</span><br><span class=line>firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.142.166&quot; port protocol=&quot;tcp&quot; port=&quot;6379&quot; accept&quot;</span><br><span class=line></span><br><span class=line># 查看配置结果, 验证配置</span><br><span class=line>firewall-cmd --list-all</span><br><span class=line></span><br><span class=line># 删除规则</span><br><span class=line>firewall-cmd --permanent --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.142.166&quot; port protocol=&quot;tcp&quot; port=&quot;11300&quot; accept&quot;</span><br><span class=line></span><br><span class=line># 更新防火墙规则</span><br><span class=line>firewall-cmd --reload</span><br><span class=line></span><br><span class=line># 重启防火墙</span><br><span class=line>systemctl restart firewalld.service</span><br></pre></table></figure><h2 id=DDOS-deflate><a href=#DDOS-deflate class=headerlink title="DDOS deflate"></a>DDOS deflate</h2><p><code>DDOS deflate</code>是一款免费的用来防御和减轻DDOS攻击的脚本. 它通过netstat监测跟踪创建大量网络连接的IP地址, 在检测到某个结点超过预设的限制时, 该程序会通过APF或IPTABLES禁止或阻挡这些IP.<p><strong>安装</strong>:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>wget http://www.moerats.com/usr/down/DDOS/deflate.sh &amp;&amp; \</span><br><span class=line>chmod +x deflate.sh &amp;&amp; \</span><br><span class=line>./deflate.sh</span><br></pre></table></figure><p>配置文件<code>/usr/local/ddos/ddos.conf</code><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br></pre><td class=code><pre><span class=line>##### Paths of the script and other files</span><br><span class=line>PROGDIR=&quot;/usr/local/ddos&quot;</span><br><span class=line>PROG=&quot;/usr/local/ddos/ddos.sh&quot;</span><br><span class=line>IGNORE_IP_LIST=&quot;/usr/local/ddos/ignore.ip.list&quot;</span><br><span class=line># 白名单.如有反向代理,注意添加本机地址和本机外网IP地址,防止提供反向代理的主机被判定为攻击.</span><br><span class=line>CRON=&quot;/etc/cron.d/ddos.cron&quot;</span><br><span class=line>APF=&quot;/etc/apf/apf&quot;</span><br><span class=line>IPT=&quot;/sbin/iptables&quot;##### frequency in minutes for running the script</span><br><span class=line></span><br><span class=line>##### Caution: Every time this setting is changed, run the script with cron</span><br><span class=line>##### option so that the new frequency takes effect</span><br><span class=line>FREQ=1</span><br><span class=line></span><br><span class=line>##### How many connections define a bad IP? Indicate that below. </span><br><span class=line># 单IP发起连接数阀值,不建议设置太低.</span><br><span class=line>NO_OF_CONNECTIONS=150</span><br><span class=line></span><br><span class=line>##### APF_BAN=1 (Make sure your APF version is atleast 0.96)</span><br><span class=line>##### APF_BAN=0 (Uses iptables for banning ips instead of APF) </span><br><span class=line>#一般情况下你是使用iptables来做防火墙,所以这里你需要将 APF_BAN的值改为0.</span><br><span class=line>APF_BAN=1</span><br><span class=line></span><br><span class=line>##### KILL=0 (Bad IPs are’nt banned, good for interactive execution of script)</span><br><span class=line>##### KILL=1 (Recommended setting)</span><br><span class=line>KILL=1 </span><br><span class=line>#是否屏蔽IP, 默认即可</span><br><span class=line></span><br><span class=line>##### An email is sent to the following address when an IP is banned. </span><br><span class=line># 当单IP发起的连接数超过阀值后,将发邮件给指定的收件人.</span><br><span class=line>##### Blank would suppress sending of mails</span><br><span class=line>EMAIL_TO=&quot;root&quot; </span><br><span class=line># 这里是邮箱, 可以把root替换成你的邮箱</span><br><span class=line></span><br><span class=line>##### Number of seconds the banned ip should remain in blacklist. </span><br><span class=line># 设置被挡IP多少秒后移出黑名单.</span><br><span class=line>BAN_PERIOD=600</span><br></pre></table></figure><p>将上述配置文件修改完成后, 使用命令启动即可<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>ddos -d</span><br></pre></table></figure><p>Ubuntu中可能会报错:<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>root@localhost:~# ddos -d</span><br><span class=line>/usr/local/sbin/ddos: 13: [: /usr/local/ddos/ddos.conf: unexpected operator</span><br><span class=line>DDoS-Deflate version 0.6</span><br><span class=line>Copyright (C) 2005, Zaf &lt;zaf@vsnl.com&gt;</span><br></pre></table></figure><p>因为启动大多数为 bash 脚本, 而 Ubuntu 的默认环境为 dash, 所以需要使用 dpkg-reconfigure dash, 选择 NO, 切换为 bash 运行脚本:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>dpkg-reconfigure dash</span><br></pre></table></figure><h2 id=fail2ban防暴力攻击><a href=#fail2ban防暴力攻击 class=headerlink title=fail2ban防暴力攻击></a>fail2ban防暴力攻击</h2><figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>sudo apt install fail2ban</span><br></pre></table></figure><h2 id=vDDoS（只支持CentOS和CloudLinux）><a href=#vDDoS（只支持CentOS和CloudLinux） class=headerlink title=vDDoS（只支持CentOS和CloudLinux）></a>vDDoS（只支持CentOS和CloudLinux）</h2><p><strong><em><a href=https://github.com/duy13/vDDoS-Protection rel="external nofollow noopener noreferrer" target=_blank>https://github.com/duy13/vDDoS-Protection</a></em></strong><h2 id=CCKiller><a href=#CCKiller class=headerlink title=CCKiller></a>CCKiller</h2><p><strong><em><a href=https://github.com/jagerzhang/CCKiller rel="external nofollow noopener noreferrer" target=_blank>https://github.com/jagerzhang/CCKiller</a></em></strong><h1 id=VPS-Speed-Test><a href=#VPS-Speed-Test class=headerlink title="VPS Speed Test"></a>VPS Speed Test</h1><h2 id=speedtest><a href=#speedtest class=headerlink title=speedtest></a>speedtest</h2><p>下载:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>wget https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py &amp;&amp; \</span><br><span class=line>chmod +x speedtest.py</span><br></pre></table></figure><p>运行:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>./speedtest.py</span><br><span class=line></span><br><span class=line>#或者</span><br><span class=line>python speedtest.py</span><br></pre></table></figure><p>结果:<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line>[root@li1890-191 ~]# ./speedtest.py</span><br><span class=line>Retrieving speedtest.net configuration...</span><br><span class=line>Testing from Linode (123.456.789.123)...</span><br><span class=line>Retrieving speedtest.net server list...</span><br><span class=line>Selecting best server based on ping...</span><br><span class=line>Hosted by IPA CyberLab (Bunkyo) [5.97 km]: 2.998 ms</span><br><span class=line>Testing download speed................................................................................</span><br><span class=line>Download: 2036.69 Mbit/s</span><br><span class=line>Testing upload speed................................................................................................</span><br><span class=line>Upload: 208.17 Mbit/s</span><br></pre></table></figure><h2 id=speedtest-cli><a href=#speedtest-cli class=headerlink title=speedtest-cli></a>speedtest-cli</h2><blockquote><p>地址: <strong><em><a href=https://github.com/sivel/speedtest-cli rel="external nofollow noopener noreferrer" target=_blank>https://github.com/sivel/speedtest-cli</a></em></strong></blockquote><p>pip方式安装<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>pip install speedtest-cli</span><br></pre></table></figure><p>或github安装<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>git clone https://github.com/sivel/speedtest-cli.git</span><br><span class=line>python speedtest-cli/setup.py install</span><br></pre></table></figure><p>用法:<p>1、list<p>根据距离显示所有的节点服务器列表.<p>2、列出所有北京节点服务器<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>[root@li1890-191 ~]# speedtest-cli --list | grep Beijing</span><br><span class=line> 4713) China Mobile Group Beijing Co.Ltd (Beijing, China) [2093.67 km]</span><br><span class=line> 5505) Beijing Broadband Network (Beijing, China) [2093.67 km]</span><br><span class=line> 5145) Beijing Unicom (Beijing, China) [2093.67 km]</span><br><span class=line>18462) Beijing Broadband Network (Beijing, China) [2093.67 km]</span><br></pre></table></figure><p>3、选择节点测试下载速度<figure class="highlight plain"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>speedtest-cli --server=6611</span><br></pre></table></figure><h1 id=Finally><a href=#Finally class=headerlink title=Finally></a>Finally</h1><p>低调服用. . .</div><div style=text-align:center;color:#ccc;font-size:14px>---------------- The End ----------------</div><div><div id=wechat_subscriber style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"><img id=wechat_subscriber_qcode src=/images/wechat/gongzhonghao.jpg alt="ookamiAntD wechat" style=width:200px;max-width:100%><div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>谢谢大爷～</div><button id=rewardButton disable=enable onclick="var qr=document.getElementById('QR');if(qr.style.display==='none'){qr.style.display='block';}else{qr.style.display='none'}">
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/images/donate/wechat.png alt="ookamiAntD WeChat Pay"><p>微信打赏</div><div id=alipay style=display:inline-block><img id=alipay_qr src=/images/donate/alipay.jpg alt="ookamiAntD Alipay"><p>支付宝打赏</div></div></div></div><div><p id=div-border-left-red>Author：<b>ookamiAntD Yang</b><br>Link：<a href=/2017/v2proxy/ title="V2Proxy 正确的代理模式">http://yangbingdong.com/2017/v2proxy/</a><br>Contact：<a>yangbingdong1994@gmail.com</a><br><b>本文基于<a target=_blank title="Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)" href=http://creativecommons.org/licenses/by-sa/4.0/ rel="external nofollow noopener noreferrer"> 知识共享署名-相同方式共享 4.0 </a>国际许可协议发布</b><br><b>转载请注明出处，谢谢！</b></div><footer class=post-footer><div class=post-tags><a href=/tags/VPS/ rel=tag><i class="fa fa-tag"></i>VPS</a>
<a href=/tags/ShadowSocks/ rel=tag><i class="fa fa-tag"></i>ShadowSocks</a>
<a href=/tags/V2Ray/ rel=tag><i class="fa fa-tag"></i>V2Ray</a>
<a href=/tags/Trojan/ rel=tag><i class="fa fa-tag"></i>Trojan</a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/2017/java-call-by-value/ rel=next title=Java基本数据类型传递与引用传递的那点事><i class="fa fa-chevron-left"></i>Java基本数据类型传递与引用传递的那点事</a></div><span class=post-nav-divider></span><div class="post-nav-prev post-nav-item"><a href=/2017/nginx-noob-guide/ rel=prev title=NGINX初学指南(安装与简单配置)>NGINX初学指南(安装与简单配置) <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class=post-spread><div class=-hoofoo-share-title>分享到：</div><div class=-hoofoo-share-buttons><div class="-mob-share-weibo -hoofoo-share-weibo -hoofoo-share-ui-button"><i class="fa fa-weibo" aria-hidden=true></i></div><div class="-mob-share-weixin -hoofoo-share-weixin -hoofoo-share-ui-button"><i class="fa fa-weixin" aria-hidden=true></i></div><div class="-mob-share-qq -hoofoo-share-qq -hoofoo-share-ui-button"><i class="fa fa-qq" aria-hidden=true></i></div><div class="-mob-share-twitter -hoofoo-share-twitter -hoofoo-share-ui-button"><i class="fa fa-twitter" aria-hidden=true></i></div><div class="-hoofoo-share-more -hoofoo-share-ui-button -mob-share-open"><i class="fa fa-ellipsis-h" aria-hidden=true></i></div></div><div class=-mob-share-ui style=display:none><ul class=-mob-share-list><li class=-mob-share-weibo><p>新浪微博<li class=-mob-share-weixin><p>微信<li class=-mob-share-qzone><p>QQ空间<li class=-mob-share-qq><p>QQ好友<li class=-mob-share-tencentweibo><p>腾讯微博<li class=-mob-share-renren><p>人人网<li class=-mob-share-kaixin><p>开心网<li class=-mob-share-douban><p>豆瓣<li class=-mob-share-youdao><p>有道云笔记<li class=-mob-share-mingdao><p>明道<li class=-mob-share-pengyou><p>朋友网<li class=-mob-share-facebook><p>Facebook<li class=-mob-share-twitter><p>Twitter<li class=-mob-share-pocket><p>Pocket<li class=-mob-share-google><p>Google+<li class=-mob-share-tumblr><p>Tumblr<li class=-mob-share-instapaper><p>Instapaper<li class=-mob-share-linkedin><p>Linkedin</ul><div class=-mob-share-close>取消</div></div><div class=-mob-share-ui-bg></div><script id=-mob-share src="https://f1.webshare.mob.com/code/mob-share.js?appkey=21aa3b13ad233"></script></div></div></div><div class=comments id=comments><div style=text-align:center></div><div id=disqus_proxy_thread></div><div id=disqus_thread></div><script>window.disqusProxy={username:'ookamiantd',server:'disqus-proxy.yangbingdong.com',port:'',defaultAvatar:'/images/avatar/avatar-default.jpg',adminAvatar:'/images/avatar/avatar-admin.jpg',identifier:'2017/v2proxy/'};window.disqus_config=function(){this.page.url='http://yangbingdong.com/2017/v2proxy/';this.page.identifier='2017/v2proxy/';};window.onload=function(){var s=document.createElement('script');s.src="/static/js/main.0d0338ae.js";s.async=true;document.body.appendChild(s);}</script><link rel=stylesheet href=/static/css/main.0603c539.css></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target=post-toc-wrap>Table of Contents<li class=sidebar-nav-overview data-target=site-overview>Overview</ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/images/avatar/avatar-admin.jpg alt=ookamiAntD><p class=site-author-name itemprop=name>ookamiAntD<p class="site-description motion-element" itemprop=description>码渣 | rocker | 二次元 | 美剧 | 宅</div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/archives><span class=site-state-item-count>48</span>
<span class=site-state-item-name>posts</span></a></div><div class="site-state-item site-state-categories"><a href=/categories><span class=site-state-item-count>19</span>
<span class=site-state-item-name>categories</span></a></div><div class="site-state-item site-state-tags"><a href=/tags><span class=site-state-item-count>45</span>
<span class=site-state-item-name>tags</span></a></div></nav><div class="feed-link motion-element"><a href=/atom.xml rel=alternate><i class="fa fa-rss"></i>RSS</a></div><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/masteranthoneyd target=_blank rel="external nofollow noopener noreferrer" title=GitHub><i class="fa fa-fw fa-github"></i>GitHub</a></span>
<span class=links-of-author-item><a href="https://www.facebook.com/profile.php?id=100014869064462" target=_blank rel="external nofollow noopener noreferrer" title=Facebook><i class="fa fa-fw fa-facebook"></i>Facebook</a></span>
<span class=links-of-author-item><a href=https://twitter.com/ookamiAntD target=_blank rel="external nofollow noopener noreferrer" title=Twitter><i class="fa fa-fw fa-twitter"></i>Twitter</a></span></div><div class="cc-license motion-element" itemprop=license><a href=https://creativecommons.org/licenses/by-sa/4.0/ class=cc-opacity target=_blank rel="external nofollow noopener noreferrer"><img src=/images/cc-by-sa.svg alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class=links-of-blogroll-title><i class="fa  fa-fw fa-globe"></i>大神们的博客</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://mercyblitz.github.io/ title=mercyblitz(Java劝退师) target=_blank rel="external nofollow noopener noreferrer">mercyblitz(Java劝退师)</a><li class=links-of-blogroll-item><a href=https://muyinchen.github.io/ title=知秋大神(真·大神) target=_blank rel="external nofollow noopener noreferrer">知秋大神(真·大神)</a><li class=links-of-blogroll-item><a href=http://crossoverjie.top/ title="crossoverJie's Blog" target=_blank rel="external nofollow noopener noreferrer">crossoverJie's Blog</a><li class=links-of-blogroll-item><a href=http://yemengying.com/ title="Giraffe's Home" target=_blank rel="external nofollow noopener noreferrer">Giraffe's Home</a></ul></div><div id=days></div><script>function show_date_time(){window.setTimeout("show_date_time()",1000);BirthDay=new Date("01/10/2017 12:34:56");today=new Date();timeold=(today.getTime()-BirthDay.getTime());sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);e_hrsold=(e_daysold-daysold)*24;hrsold=setzero(Math.floor(e_hrsold));e_minsold=(e_hrsold-hrsold)*60;minsold=setzero(Math.floor((e_hrsold-hrsold)*60));seconds=setzero(Math.floor((e_minsold-minsold)*60));document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";}
function setzero(i){if(i<10)
{i="0"+i};return i;}
show_date_time();</script></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class=post-toc><div class=post-toc-content><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link href=#Preface><span class=nav-number>1.</span> <span class=nav-text>Preface</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#代理方式介绍><span class=nav-number>2.</span> <span class=nav-text>代理方式介绍</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#VPS选择><span class=nav-number>3.</span> <span class=nav-text>VPS选择</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#准备工作><span class=nav-number>4.</span> <span class=nav-text>准备工作</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#准备一台VPS><span class=nav-number>4.1.</span> <span class=nav-text>准备一台VPS</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#SSH无密码登录VPS-可选><span class=nav-number>4.2.</span> <span class=nav-text>SSH无密码登录VPS (可选)</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#各大代理安装与使用><span class=nav-number>5.</span> <span class=nav-text>各大代理安装与使用</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Shadowsocks><span class=nav-number>5.1.</span> <span class=nav-text>Shadowsocks</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#服务端><span class=nav-number>5.1.1.</span> <span class=nav-text>服务端</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#脚本一键安装><span class=nav-number>5.1.2.</span> <span class=nav-text>脚本一键安装</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#客户端><span class=nav-number>5.1.3.</span> <span class=nav-text>客户端</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#多用户管理><span class=nav-number>5.1.4.</span> <span class=nav-text>多用户管理</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#V2Ray><span class=nav-number>5.2.</span> <span class=nav-text>V2Ray</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#服务端-1><span class=nav-number>5.2.1.</span> <span class=nav-text>服务端</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#客户端-1><span class=nav-number>5.2.2.</span> <span class=nav-text>客户端</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#多用户管理UI><span class=nav-number>5.2.3.</span> <span class=nav-text>多用户管理UI</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Trajon><span class=nav-number>5.3.</span> <span class=nav-text>Trajon</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#服务端-2><span class=nav-number>5.3.1.</span> <span class=nav-text>服务端</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#客户端-2><span class=nav-number>5.3.2.</span> <span class=nav-text>客户端</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Just-My-Socks><span class=nav-number>5.4.</span> <span class=nav-text>Just My Socks</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#将流量转发到代理><span class=nav-number>6.</span> <span class=nav-text>将流量转发到代理</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#浏览器转发><span class=nav-number>6.1.</span> <span class=nav-text>浏览器转发</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#SwitchyOmega插件安装><span class=nav-number>6.1.1.</span> <span class=nav-text>SwitchyOmega插件安装</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#设置代理地址><span class=nav-number>6.1.2.</span> <span class=nav-text>设置代理地址</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#设置自动切换><span class=nav-number>6.1.3.</span> <span class=nav-text>设置自动切换</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#GenPAC全局代理><span class=nav-number>6.2.</span> <span class=nav-text>GenPAC全局代理</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#安装><span class=nav-number>6.2.1.</span> <span class=nav-text>安装</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#设置全局代理><span class=nav-number>6.2.2.</span> <span class=nav-text>设置全局代理</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Proxychains-代理><span class=nav-number>6.3.</span> <span class=nav-text>Proxychains 代理</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Privoxy><span class=nav-number>6.4.</span> <span class=nav-text>Privoxy</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#网络优化><span class=nav-number>7.</span> <span class=nav-text>网络优化</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Google-BBR><span class=nav-number>7.1.</span> <span class=nav-text>Google BBR</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#更换Linode内核><span class=nav-number>7.1.1.</span> <span class=nav-text>更换Linode内核</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#手动安装><span class=nav-number>7.1.2.</span> <span class=nav-text>手动安装</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#开启TCP-Fast-Open><span class=nav-number>7.2.</span> <span class=nav-text>开启TCP Fast Open</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#TCP优化><span class=nav-number>7.3.</span> <span class=nav-text>TCP优化</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#使用特殊端口><span class=nav-number>7.4.</span> <span class=nav-text>使用特殊端口</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#VPS-Security><span class=nav-number>8.</span> <span class=nav-text>VPS Security</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#修改SSH登录端口><span class=nav-number>8.1.</span> <span class=nav-text>修改SSH登录端口</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Ubuntu><span class=nav-number>8.1.1.</span> <span class=nav-text>Ubuntu</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#CentOS><span class=nav-number>8.1.2.</span> <span class=nav-text>CentOS</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#使用密钥登录SSH><span class=nav-number>8.2.</span> <span class=nav-text>使用密钥登录SSH</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#防火墙><span class=nav-number>8.3.</span> <span class=nav-text>防火墙</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Ubuntu防火墙UFW><span class=nav-number>8.3.1.</span> <span class=nav-text>Ubuntu防火墙UFW</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#CentOS-1><span class=nav-number>8.3.2.</span> <span class=nav-text>CentOS</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#DDOS-deflate><span class=nav-number>8.4.</span> <span class=nav-text>DDOS deflate</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#fail2ban防暴力攻击><span class=nav-number>8.5.</span> <span class=nav-text>fail2ban防暴力攻击</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#vDDoS（只支持CentOS和CloudLinux）><span class=nav-number>8.6.</span> <span class=nav-text>vDDoS（只支持CentOS和CloudLinux）</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#CCKiller><span class=nav-number>8.7.</span> <span class=nav-text>CCKiller</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#VPS-Speed-Test><span class=nav-number>9.</span> <span class=nav-text>VPS Speed Test</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#speedtest><span class=nav-number>9.1.</span> <span class=nav-text>speedtest</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#speedtest-cli><span class=nav-number>9.2.</span> <span class=nav-text>speedtest-cli</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#Finally><span class=nav-number>10.</span> <span class=nav-text>Finally</span></a></ol></div></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=busuanzi-count><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=site-uv><i class="fa fa-user">本站访客数</i><span class=busuanzi-value id=busuanzi_value_site_uv></span>人次</span>
<span class=site-pv><i class="fa fa-eye">本站总访问量</i><span class=busuanzi-value id=busuanzi_value_site_pv></span>次</span></div><div class=copyright>&copy; 2016 -
<span itemprop=copyrightYear>2020</span>
<span class=with-love><i class="fa fa-flash"></i></span><span class=author itemprop=copyrightHolder>Hosted by <a href=https://pages.coding.me style=font-weight:700 rel="external nofollow noopener noreferrer" target=_blank>Coding Pages</a></span> | <span class=post-count>共280.0k字</span></div><div class=theme-info><a target=_blank href=http://www.miibeian.gov.cn/ rel=nofollow style=color:#555>粤ICP备18135202号-1</a></div><div style="width:300px;margin:0 auto"><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44010602005896" style=display:inline-block;text-decoration:none;height:20px;line-height:20px><img src=https://cdn.yangbingdong.com/img/beian/beian.png style=float:left><p style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#555">粤公网安备 44010602005896号</p></a></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i></div></div><script>if(Object.prototype.toString.call(window.Promise)!=='[object Function]'){window.Promise=null;}</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script src="/js/src/utils.js?v=5.1.0"></script><script src="/js/src/motion.js?v=5.1.0"></script><script src="/js/src/scrollspy.js?v=5.1.0"></script><script src="/js/src/post-details.js?v=5.1.0"></script><script src="/js/src/bootstrap.js?v=5.1.0"></script><script>var disqus_shortname='ookamiantd';var disqus_identifier='2017/v2proxy/';var disqus_title="V2Proxy 正确的代理模式";function run_disqus_script(disqus_script){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/'+disqus_script;(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);}
var disqus={load:function disqus(){if(typeof DISQUS!=='object'){(function(){var s=document.createElement('script');s.async=true;s.type='text/javascript';s.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('HEAD')[0]||document.getElementsByTagName('BODY')[0]).appendChild(s);}());$('#load-disqus').html("评论加载中，请确保你有梯子，若评论长时间未加载则你可能翻墙失败...").fadeOut(9000);}}}</script><script>var isfetched=false;var search_path="search.xml";if(search_path.length==0){search_path="search.xml";}
var path="/"+search_path;function proceedsearch(){$("body").append('<div class="popoverlay">').css('overflow','hidden');$('.popup').toggle();}
var searchFunc=function(path,search_id,content_id){'use strict';$.ajax({url:path,dataType:"xml",async:true,success:function(xmlResponse){isfetched=true;$('.popup').detach().appendTo('.header-inner');var datas=$("entry",xmlResponse).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()};}).get();var $input=document.getElementById(search_id);var $resultContent=document.getElementById(content_id);$input.addEventListener('input',function(){var matchcounts=0;var str='<ul class=\"search-result-list\">';var keywords=this.value.trim().toLowerCase().split(/[\s\-]+/);$resultContent.innerHTML="";if(this.value.trim().length>1){datas.forEach(function(data){var isMatch=false;var content_index=[];var data_title=data.title.trim().toLowerCase();var data_content=data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();var data_url=decodeURIComponent(data.url);var index_title=-1;var index_content=-1;var first_occur=-1;if(data_title!=''){keywords.forEach(function(keyword,i){index_title=data_title.indexOf(keyword);index_content=data_content.indexOf(keyword);if(index_title>=0||index_content>=0){isMatch=true;if(i==0){first_occur=index_content;}}});}
if(isMatch){matchcounts+=1;str+="<li><a href='"+data_url+"' class='search-result-title'>"+data_title+"</a>";var content=data.content.trim().replace(/<[^>]+>/g,"");if(first_occur>=0){var start=first_occur-20;var end=first_occur+80;if(start<0){start=0;}
if(start==0){end=50;}
if(end>content.length){end=content.length;}
var match_content=content.substring(start,end);keywords.forEach(function(keyword){var regS=new RegExp(keyword,"gi");match_content=match_content.replace(regS,"<b class=\"search-keyword\">"+keyword+"</b>");});str+="<p class=\"search-result\">"+match_content+"...</p>"}
str+="</li>";}})};str+="</ul>";if(matchcounts==0){str='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'}
if(keywords==""){str='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'}
$resultContent.innerHTML=str;});proceedsearch();}});}
$('.popup-trigger').click(function(e){e.stopPropagation();if(isfetched==false){searchFunc(path,'local-search-input','local-search-result');}else{proceedsearch();};});$('.popup-btn-close').click(function(e){$('.popup').hide();$(".popoverlay").remove();$('body').css('overflow','');});$('.popup').click(function(e){e.stopPropagation();});</script><script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js></script><script>AV.initialize("usE0s6JGUeOiMcsVoRuHuv2B-gzGzoHsz","ewm6NEF07r83HbnOr63ptuKH");</script><script>function showTime(Counter){var query=new AV.Query(Counter);var entries=[];var $visitors=$(".leancloud_visitors");$visitors.each(function(){entries.push($(this).attr("id").trim());});query.containedIn('url',entries);query.find().done(function(results){var COUNT_CONTAINER_REF='.leancloud-visitors-count';if(results.length===0){$visitors.find(COUNT_CONTAINER_REF).text(0);return;}
for(var i=0;i<results.length;i++){var item=results[i];var url=item.get('url');var time=item.get('time');var element=document.getElementById(url);$(element).find(COUNT_CONTAINER_REF).text(time);}
for(var i=0;i<entries.length;i++){var url=entries[i];var element=document.getElementById(url);var countSpan=$(element).find(COUNT_CONTAINER_REF);if(countSpan.text()==''){countSpan.text(0);}}}).fail(function(object,error){console.log("Error: "+error.code+" "+error.message);});}
function addCount(Counter){var $visitors=$(".leancloud_visitors");var url=$visitors.attr('id').trim();var title=$visitors.attr('data-flag-title').trim();var query=new AV.Query(Counter);query.equalTo("url",url);query.find({success:function(results){if(results.length>0){var counter=results[0];counter.fetchWhenSave(true);counter.increment("time");counter.save(null,{success:function(counter){var $element=$(document.getElementById(url));$element.find('.leancloud-visitors-count').text(counter.get('time'));},error:function(counter,error){console.log('Failed to save Visitor num, with error message: '+error.message);}});}else{var newcounter=new Counter();var acl=new AV.ACL();acl.setPublicReadAccess(true);acl.setPublicWriteAccess(true);newcounter.setACL(acl);newcounter.set("title",title);newcounter.set("url",url);newcounter.set("time",1);newcounter.save(null,{success:function(newcounter){var $element=$(document.getElementById(url));$element.find('.leancloud-visitors-count').text(newcounter.get('time'));},error:function(newcounter,error){console.log('Failed to create');}});}},error:function(error){console.log('Error:'+error.code+" "+error.message);}});}
$(function(){var Counter=AV.Object.extend("Counter");if($('.leancloud_visitors').length==1){addCount(Counter);}else if($('.post-title-link').length>1){showTime(Counter);}});</script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script color=255,0,204 opacity=0.5 zindex=-2 count=40 src=//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js></script><script>$('body').delegate('.-mob-share-weixin-qrcode-bg','click',function(){$(".-mob-share-weixin-qrcode-close").trigger("click");});</script><canvas class=fireworks style=position:fixed;left:0;top:0;z-index:1;pointer-events:none></canvas>
<script src=//cdn.bootcss.com/animejs/2.2.0/anime.min.js></script><script src=/js/src/fireworks.js></script><script src=/js/src/dytitle.js></script></div></footer></div><script src=/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"superSample":2,"width":88,"height":88,"position":"left"},"mobile":{"show":false},"react":{"opacityDefault":0.9,"opacityOnHover":0.5},"log":false});</script>